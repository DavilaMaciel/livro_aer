<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 8 Modelos Lineares Generalizados | Análises Ecológicas no R</title>
<meta name="author" content="Fernando Rodrigues da Silva, Thiago Gonçalves-Souza, Gustavo Brant Paterno,   Diogo Borges Provete, Maurício Humberto Vancine">
<meta name="description" content="Pré-requisitos do capítulo Pacotes e dados que serão utilizados neste capítulo. library(ecodados) library(visdat) library(tidyverse) library(lattice) library(RVAideMemoire) library(DHARMa)...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="Capítulo 8 Modelos Lineares Generalizados | Análises Ecológicas no R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://analises-ecologicas.netlify.app/cap8.html">
<meta property="og:image" content="https://analises-ecologicas.netlify.app/img/capa.jpeg">
<meta property="og:description" content="Pré-requisitos do capítulo Pacotes e dados que serão utilizados neste capítulo. library(ecodados) library(visdat) library(tidyverse) library(lattice) library(RVAideMemoire) library(DHARMa)...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Capítulo 8 Modelos Lineares Generalizados | Análises Ecológicas no R">
<meta name="twitter:description" content="Pré-requisitos do capítulo Pacotes e dados que serão utilizados neste capítulo. library(ecodados) library(visdat) library(tidyverse) library(lattice) library(RVAideMemoire) library(DHARMa)...">
<meta name="twitter:image" content="https://analises-ecologicas.netlify.app/img/capa.jpeg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-23BB46Y290"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-23BB46Y290');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Análises Ecológicas no R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Procurar" aria-label="Procurar">
</form>

      <nav aria-label="Sumário"><h2><b>Sumário</b></h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Bem-vindos</a></li>
<li><a class="" href="pref%C3%A1cio.html">Prefácio</a></li>
<li><a class="" href="dedicat%C3%B3ria.html">Dedicatória</a></li>
<li><a class="" href="sobre-os-autores.html">Sobre os autores</a></li>
<li><a class="" href="revisores-e-colaboradores.html">Revisores e colaboradores</a></li>
<li><a class="" href="cap1.html"><span class="header-section-number">1</span> Introdução</a></li>
<li><a class="" href="cap2.html"><span class="header-section-number">2</span> Voltando ao básico: como dominar a arte de fazer perguntas cientificamente relevantes</a></li>
<li><a class="" href="cap3.html"><span class="header-section-number">3</span> Pré-requisitos</a></li>
<li><a class="" href="cap4.html"><span class="header-section-number">4</span> Introdução ao R</a></li>
<li><a class="" href="cap5.html"><span class="header-section-number">5</span> Tidyverse</a></li>
<li><a class="" href="cap6.html"><span class="header-section-number">6</span> Visualização de dados</a></li>
<li><a class="" href="cap7.html"><span class="header-section-number">7</span> Modelos lineares</a></li>
<li><a class="active" href="cap8.html"><span class="header-section-number">8</span> Modelos Lineares Generalizados</a></li>
<li><a class="" href="cap9.html"><span class="header-section-number">9</span> Análises Multidimensionais</a></li>
<li><a class="" href="cap10.html"><span class="header-section-number">10</span> Rarefação</a></li>
<li><a class="" href="cap11.html"><span class="header-section-number">11</span> Estimadores de riqueza</a></li>
<li><a class="" href="cap12.html"><span class="header-section-number">12</span> Diversidade Taxonômica</a></li>
<li><a class="" href="cap13.html"><span class="header-section-number">13</span> Diversidade Filogenética</a></li>
<li><a class="" href="cap14.html"><span class="header-section-number">14</span> Diversidade Funcional</a></li>
<li><a class="" href="cap15.html"><span class="header-section-number">15</span> Dados geoespaciais</a></li>
<li><a class="" href="gloss%C3%A1rio.html">Glossário</a></li>
<li><a class="" href="refer%C3%AAncias.html">Referências</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/paternogbc/livro_aer">Ver código fonte <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="cap8" class="section level1" number="8">
<h1>
<span class="header-section-number">Capítulo 8</span> Modelos Lineares Generalizados<a class="anchor" aria-label="anchor" href="#cap8"><i class="fas fa-link"></i></a>
</h1>
<div id="pré-requisitos-do-capítulo-4" class="section level2 unnumbered">
<h2>Pré-requisitos do capítulo<a class="anchor" aria-label="anchor" href="#pr%C3%A9-requisitos-do-cap%C3%ADtulo-4"><i class="fas fa-link"></i></a>
</h2>
<p>Pacotes e dados que serão utilizados neste capítulo.</p>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ecodados</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://visdat.njtierney.com/">visdat</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://lattice.r-forge.r-project.org/">lattice</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RVAideMemoire</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://florianhartig.github.io/DHARMa/">DHARMa</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/performance/">performance</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">MuMIn</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jslefche/">piecewiseSEM</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/daattali/ggExtra">ggExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">Rmisc</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rvlenth/emmeans">emmeans</a></span><span class="op">)</span> 
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://strengejacke.github.io/sjPlot/">sjPlot</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbolker/bbmle">bbmle</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/glmmTMB/glmmTMB">glmmTMB</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/runehaubo/ordinal">ordinal</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/frmunoz/ecolottery">ecolottery</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/njtierney/naniar">naniar</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">vcd</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">generalhoslem</span><span class="op">)</span>

<span class="co">## Dados</span>
<span class="va">lagartos</span> <span class="op">&lt;-</span> <span class="fu">ecodados</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ecodados/man/lagartos.html">lagartos</a></span>
<span class="va">parasitas</span> <span class="op">&lt;-</span> <span class="fu">ecodados</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ecodados/man/parasitas.html">parasitas</a></span>
<span class="va">fish</span> <span class="op">&lt;-</span> <span class="fu">ecodados</span><span class="fu">::</span><span class="va">fish</span>
<span class="va">fragmentos</span> <span class="op">&lt;-</span> <span class="fu">ecodados</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ecodados/man/fragmentos.html">fragmentos</a></span>
<span class="va">uv_cells</span> <span class="op">&lt;-</span> <span class="fu">ecodados</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ecodados/man/uv_cells.html">uv_cells</a></span></code></pre></div>
</div>
<div id="introdução-2" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Introdução<a class="anchor" aria-label="anchor" href="#introdu%C3%A7%C3%A3o-2"><i class="fas fa-link"></i></a>
</h2>
<p>No Capítulo <a href="cap7.html#cap7">7</a>, descrevemos sobre os modelos lineares (também chamados de Modelos Lineares Gerais) que podem ser descritos pelo mesmo modelo matemático de uma equação da reta do tipo:</p>
<p><span class="math display">\[Y = \beta_0 + \beta_{1}X_i + \epsilon_i\]</span></p>
<p>Nesse tipo de estrutura, o que difere uma regressão linear de uma análise de variância é a natureza do elemento x<sub>i</sub>, variável contínua para a regressão linear e variável categórica no caso da ANOVA (que é codificada numa matriz <em>design</em> para desenhos mais complexos). Nesse sentido, o que todos esses métodos têm em comum é a variável resposta Y que é um vetor numérico contínuo. Outro elemento em comum desses métodos é a distribuição de frequência do erro. Se quiser mais detalhes sobre como modelos lineares podem ser escritos na forma de matrizes, consulte a introdução de Fox et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-fox_ecological_2015" role="doc-biblioref">2015</a>)</span>. Todos os modelos lineares assumem que a distribuição do erro seja Gaussiana (ou Normal). Isso de certa forma limita o tipo de dado que pode ser usado como variável resposta por estas análises. Por exemplo, dados de contagem (e.g., riqueza e/ou abundância de espécies), frequência (e.g., frequência de ocorrência, porcentagem de cobertura vegetal), incidência (e.g., presença ou ausência de uma espécie) ou proporção (e.g., números de animais infectados a cada 1000 animais) não são adequados para serem utilizados como variáveis resposta em modelos lineares. Uma prática comum quando nossos dados não são Normais é transformar por logaritmo ou raiz quadrada. No entanto, para dados de contagem isso não é recomendado - veja O’Hara &amp; Kotze <span class="citation">(<a href="refer%C3%AAncias.html#ref-ohara2010" role="doc-biblioref">2010</a>)</span>, Ives <span class="citation">(<a href="refer%C3%AAncias.html#ref-ives2015" role="doc-biblioref">2015</a>)</span> e Warton <span class="citation">(<a href="refer%C3%AAncias.html#ref-warton2018" role="doc-biblioref">2018</a>)</span> para mais detalhes.</p>
<p>Nestes casos, devemos recorrer a um conjunto de modelos chamados Modelos Lineares Generalizados (GLM). Nestes modelos, o usuário especifica a distribuição de frequência que deseja utilizar para modelar a variável resposta. Esta distribuição de frequência deve pertencer à família exponencial, que inclui a distribuição de Poisson, Gaussiana, binomial, binomial negativa, Gamma, Bernoulli e Beta. Ainda é possível utilizar <em>Cumulative Link Models</em> para modelar dados ordinais (fatores cuja ordem dos elementos importa, tais como muito baixo, baixo, alto e muito alto). Abaixo vamos ver um pouco sobre como um GLM funciona e exemplos com cada uma destas distribuições.</p>
</div>
<div id="como-um-glm-funciona" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Como um GLM funciona?<a class="anchor" aria-label="anchor" href="#como-um-glm-funciona"><i class="fas fa-link"></i></a>
</h2>
<p>Diferentemente do modelo linear, um GLM estima os parâmetros por meio de Máxima Verossimilhança (ML) ao invés dos Mínimos Quadrados Comuns, também chamados de Mínimos Quadrados Ordinários (OLS).</p>
<p>Portanto, um GLM relaciona a <strong>distribuição da variável resposta</strong> aos <strong>preditores lineares</strong> por meio de uma <strong>função de ligação</strong>. Por exemplo, no caso da distribuição de Poisson, usa-se uma ligação logarítmica (também chamada de log link) que garante que o valores ajustados são sempre não negativos. Portanto, um GLM é composto por esses três componentes: i) função de distribuição, ii) preditor linear e iii) função de ligação. A função de distribuição é uma hipótese sobre a distribuição da variável resposta Y<sub>i</sub>. Isso também define a média e a variância de Y<sub>i</sub>. Já a função de ligação define a relação entre o valor médio de Y<sub>i</sub> e da parte sistemática. Esta é também chamada de ligação entre a média e a parte sistemática do modelo. Existem três tipos de função de ligação:</p>
<ul>
<li><p><strong>Identity link</strong>, que é definido por <code>g(µ) = μ</code>, e modela a média ou valor esperado de Y. Usado em modelos lineares padrão</p></li>
<li><p><strong>Log link</strong>, que é <code>g(μ) = log(μ)</code>, e modela o log da média. É usado para dados de contagem (que não podem assumir valores negativos) em modelos log-linear</p></li>
<li><p><strong>Logit link</strong>, que é <code>g(μ) = log[μ/(1-μ)]</code>, e é usado para dados binários e regressão logística</p></li>
</ul>
<p>Logo, um modelo linear pode ser visto como um caso particular de um GLM em que utiliza distribuição Gaussiana, com <em>identity link</em>.</p>
</div>
<div id="como-escolher-a-distribuição-correta-para-seus-dados" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Como escolher a distribuição correta para seus dados?<a class="anchor" aria-label="anchor" href="#como-escolher-a-distribui%C3%A7%C3%A3o-correta-para-seus-dados"><i class="fas fa-link"></i></a>
</h2>
<div id="para-dados-contínuos" class="section level3" number="8.3.1">
<h3>
<span class="header-section-number">8.3.1</span> Para dados contínuos<a class="anchor" aria-label="anchor" href="#para-dados-cont%C3%ADnuos"><i class="fas fa-link"></i></a>
</h3>
<p>Se Y é uma variável contínua, a sua distribuição de probabilidade deve ser normal. Nesses casos as distribuições recomendadas são a <strong>Gaussiana (Normal) ou Gamma</strong>. Para essas distribuições, o parâmetro de dispersão é estimado separadamente da média e é às vezes, chamado de <em>nuisance parameter</em>. Uma particularidade da distribuição Gamma é que ela só aceita valores contínuos positivos maiores que zero.</p>
<p>Se Y é uma variável de proporção que varia continuamente entre 0 e 1 ou 0 e 100, mas não inclui 0 nem 1, a distribuição recomendada é a beta. Um exemplo é a área (Km^2) de floresta numa imagem de satélite, cuja área total é conhecida. Caso a variável inclua 0 e 1 (e.g., 100% da imagem é composta por floresta), deve-se realizar uma <a href="https://doi.apa.org/doiLanding?doi=10.1037%2F1082-989X.11.1.54">transformação nos dados</a>.</p>
</div>
<div id="para-dados-de-contagem" class="section level3" number="8.3.2">
<h3>
<span class="header-section-number">8.3.2</span> Para dados de contagem<a class="anchor" aria-label="anchor" href="#para-dados-de-contagem"><i class="fas fa-link"></i></a>
</h3>
<p>Se Y é binário (e.g., vivo ou morto), a distribuição de probabilidade deve ser <strong>binomial</strong>.</p>
<p>Se Y é uma contagem (e.g., abundância ou riqueza de espécies), então a distribuição de probabilidade deve ser <strong>Poisson ou binomial negativa</strong>. Existem também correções dessas distribuições quando apresentam sobredispersão (<em>overdispersion</em>), tais como quasi-Poisson ou quasi-Negative binomial. Falaremos delas no momento certo.</p>
<p>Para distribuições tais como binomial e Poisson, a variância deve ser igual à média e o parâmetro de dispersão é sempre 1. Na maioria dos dados ecológicos esse pressuposto não é cumprido, veremos estratégias para lidar com isso logo à frente.</p>
<p>As funções <code><a href="https://rdrr.io/pkg/vcd/man/Ord_plot.html">Ord_plot()</a></code> e <code><a href="https://rdrr.io/pkg/vcd/man/goodfit.html">goodfit()</a></code> do pacote <code>vcd</code> podem auxiliar na escolha da distribuição para dados de contagem.</p>
</div>
</div>
<div id="dados-de-contagem-a-distribuição-de-poisson" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Dados de contagem: a distribuição de Poisson<a class="anchor" aria-label="anchor" href="#dados-de-contagem-a-distribui%C3%A7%C3%A3o-de-poisson"><i class="fas fa-link"></i></a>
</h2>
<p>Para casos em que estamos interessados em quantificar uma variável discreta, ou seja, uma variável positiva, representada sempre por números inteiros, contendo um número finito de possibilidades, devemos utilizar a <strong>distribuição de Poisson</strong>. Esta distribuição é peculiar por ser descrita apenas por um parâmetro livre (<span class="math inline">\(\lambda\)</span>). Isso quer dizer que tanto a média quanto a variância dos dados são descritos por um único parâmetro, o que implica em dizer que a média e a variância têm de ser iguais.</p>
<p>Vamos ver um exemplo com dados reais.</p>
<p><strong>Exemplo 1</strong></p>
<p><strong>Explicação dos dados</strong></p>
<p>Neste exemplo, iremos utilizar dados de riqueza de anfíbios anuros coletados em 40 poças, açudes e brejos ao redor de fragmentos florestais no Noroeste Paulista <span class="citation">(<a href="refer%C3%AAncias.html#ref-prado2014" role="doc-biblioref">Prado and Rossa-Feres 2014</a>)</span>. Os autores mediram seis variáveis em escala local e outras três em escala de paisagem.</p>
<p><strong>Pergunta</strong></p>
<p>A distância linear para o corpo d’água mais próximo influencia a abundância total de espécies de anuros?</p>
<p><strong>Predições</strong></p>
<p>Corpos d’água mais conectados permitem que indivíduos dispersem entre eles com maior facilidade, suportando melhor dinâmicas de metapopulações. Portanto, espero que poças que estejam mais conectadas entre si tenham maior riqueza total de anuros.</p>
<p><strong>Variáveis</strong></p>
<ul>
<li>Variável reposta: riqueza de anuros em 40 poças</li>
<li>Variável preditora: distância da poça focal para a mais próxima na escala da paisagem</li>
</ul>
<p><strong>Checklist</strong></p>
<ul>
<li>Verificar se o seu data frame está com as unidades amostrais nas linhas (neste caso poças) e variáveis nas colunas</li>
</ul>
<p>Antes de começar com a análise, vamos primeiro explorar os dados.</p>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Explorar os dados</span>
<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">fragmentos</span><span class="op">)</span>
<span class="co">#&gt; Rows: 40</span>
<span class="co">#&gt; Columns: 40</span>
<span class="co">#&gt; $ locality    &lt;chr&gt; "MAC", "MAC", "MAC", "MAC", "MAC", "MAC", "NOV", "NOV", "NOV", "NOV", "PIN", "PIN", "PIN", "PIN", "PIN", "PLAN", "PLAN", "PL…</span>
<span class="co">#&gt; $ site        &lt;chr&gt; "MacAc1", "MacAc2", "MacAc3", "MacAc4", "MacAc5", "MacBr1", "NovBr1", "NovBr2", "NovRe2", "NovRe3", "PinAc1", "PinBr1", "Pin…</span>
<span class="co">#&gt; $ Riqueza_obs &lt;int&gt; 3, 11, 10, 10, 3, 9, 2, 8, 9, 8, 6, 4, 8, 8, 6, 17, 15, 13, 8, 10, 12, 14, 14, 12, 8, 4, 10, 7, 13, 19, 16, 13, 13, 14, 11, …</span>
<span class="co">#&gt; $ Riqueza_HB  &lt;int&gt; 6, 13, 12, 13, 6, 12, 5, 11, 12, 11, 8, 7, 10, 11, 9, 18, 17, 15, 11, 13, 14, 16, 16, 13, 11, 7, 13, 9, 15, 20, 18, 15, 15, …</span>
<span class="co">#&gt; $ Bsc         &lt;int&gt; 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0</span>
<span class="co">#&gt; $ Dne         &lt;int&gt; 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0</span>
<span class="co">#&gt; $ Dnm         &lt;int&gt; 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0</span>
<span class="co">#&gt; $ Dnn         &lt;int&gt; 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1</span>
<span class="co">#&gt; $ Dns         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0</span>
<span class="co">#&gt; $ Hal         &lt;int&gt; 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1</span>
<span class="co">#&gt; $ Hra         &lt;int&gt; 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1</span>
<span class="co">#&gt; $ Lfu         &lt;int&gt; 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1</span>
<span class="co">#&gt; $ Lla         &lt;int&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0</span>
<span class="co">#&gt; $ Lpo         &lt;int&gt; 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1</span>
<span class="co">#&gt; $ Eun         &lt;int&gt; 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0</span>
<span class="co">#&gt; $ Pce         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0</span>
<span class="co">#&gt; $ Pcu         &lt;int&gt; 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1</span>
<span class="co">#&gt; $ Pfa1        &lt;int&gt; 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1</span>
<span class="co">#&gt; $ Ppa         &lt;int&gt; 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0</span>
<span class="co">#&gt; $ Sfm         &lt;int&gt; 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 1</span>
<span class="co">#&gt; $ Sfv         &lt;int&gt; 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0</span>
<span class="co">#&gt; $ Ebi         &lt;int&gt; 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0</span>
<span class="co">#&gt; $ Esp         &lt;int&gt; 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1</span>
<span class="co">#&gt; $ hydrop      &lt;dbl&gt; -2.553590, 0.573255, 0.573255, 0.573255, -2.553590, 0.573255, 0.573255, 0.573255, 0.573255, 0.573255, -1.511308, 0.573255, 0…</span>
<span class="co">#&gt; $ hydrop2     &lt;dbl&gt; -2.235730, 0.606300, 0.606300, 0.606300, -2.235730, 0.606300, 0.606300, 0.606300, 0.606300, 0.606300, -1.667324, 0.606300, 0…</span>
<span class="co">#&gt; $ vegcov      &lt;dbl&gt; -1.461851, -1.145775, -0.987737, 0.908718, -1.461851, 1.382832, 1.382832, 1.698908, -0.829699, 0.118528, -1.145775, 0.434604…</span>
<span class="co">#&gt; $ nveg        &lt;dbl&gt; -1.965130, -0.158114, -1.061622, -0.158114, -1.965130, -0.158114, 0.745394, 1.648902, 0.745394, 1.648902, -1.061622, 0.74539…</span>
<span class="co">#&gt; $ fish        &lt;dbl&gt; -1.508310, 0.646419, -1.508310, 0.646419, -1.508310, -1.508310, 0.646419, 0.646419, 0.646419, 0.646419, -1.508310, 0.646419,…</span>
<span class="co">#&gt; $ area        &lt;dbl&gt; -2.418270, 0.147353, -0.564022, -0.348279, -2.315159, -0.601947, 1.556190, -0.255774, 0.875432, 1.295467, -1.846249, -0.6635…</span>
<span class="co">#&gt; $ area2       &lt;dbl&gt; -1.884470, 0.019560, -0.699829, -0.497176, -1.844802, -0.734057, 1.877820, -0.406145, 0.907959, 1.490478, -1.625475, -0.7887…</span>
<span class="co">#&gt; $ depth       &lt;dbl&gt; -1.232668, 0.821168, -0.704539, 0.821168, -1.306019, -1.306019, -0.645858, -0.205750, 1.554680, 1.554680, -1.232668, -1.1593…</span>
<span class="co">#&gt; $ forcov      &lt;dbl&gt; -0.604596, -0.020849, -0.013816, -0.171663, 0.203364, 0.203364, 0.562496, -0.157193, -0.793258, -0.397977, 0.022087, -0.0234…</span>
<span class="co">#&gt; $ forcov2     &lt;dbl&gt; -0.672774, -0.152952, -0.146124, -0.296136, 0.071358, 0.071358, 0.459151, -0.282666, -0.820946, -0.499384, -0.111058, -0.155…</span>
<span class="co">#&gt; $ forcov10    &lt;dbl&gt; -6.045965, -0.208489, -0.138159, -1.716633, 2.033643, 2.033643, 5.624958, -1.571928, -7.932582, -3.979765, 0.220865, -0.2348…</span>
<span class="co">#&gt; $ dfrag       &lt;dbl&gt; 0.410084, -0.097045, -1.242271, -1.242271, -0.471888, -1.242271, 1.307931, 1.557264, 0.479895, 0.966774, -0.192341, -1.24227…</span>
<span class="co">#&gt; $ dfrag2      &lt;dbl&gt; 0.166782, -0.381401, -1.059858, -1.059858, -0.688845, -1.059858, 1.510271, 1.967926, 0.254153, 0.943632, -0.467438, -1.05985…</span>
<span class="co">#&gt; $ dwater      &lt;dbl&gt; 1.198175, 0.970207, -0.121245, -0.087507, 0.162610, -0.121245, -0.087507, -1.355308, 0.113584, -0.193952, 1.560877, -1.35530…</span>
<span class="co">#&gt; $ dwater2     &lt;dbl&gt; 1.166645, 0.864035, -0.299232, -0.270350, -0.042156, -0.299232, -0.270350, -1.045428, -0.088840, -0.359939, 1.690588, -1.045…</span>
<span class="co">#&gt; $ X           &lt;dbl&gt; -49.9376, -49.9353, -49.9348, -49.9334, -49.9270, -49.9271, -49.2742, -49.3303, -49.3084, -49.3179, -48.9214, -48.9206, -48.…</span>
<span class="co">#&gt; $ Y           &lt;dbl&gt; -20.7408, -20.7410, -20.7419, -20.7462, -20.7453, -20.7451, -21.5187, -21.5282, -21.5024, -21.5148, -21.2273, -21.2227, -21.…</span></code></pre></div>
<p>Percebam que o data frame contém 40 colunas. Neste conjunto de dados as variáveis preditoras já estão padronizadas com média 0 e desvio padrão 1. As variáveis com “2” indicam variáveis quadráticas (podem ser usadas para se testar relações não lineares). Também temos a riqueza observada e a estimada (<code>Riqueza_HB</code>) e as coordenadas geográficas (X e Y). Vamos agora explorar os dados e ver como é a relação entre riqueza e distância para a poça mais próxima. Sempre é recomendado visualizar os dados antes de efetivamente os modelar para se ter uma ideia da relação entre as variáveis (Figura <a href="cap8.html#fig:fig-mod-poi-pre">8.1</a>).</p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Gráfico</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">fragmentos</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">dfrag</span>, <span class="va">Riqueza_obs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Distância para o fragmento mais próximo"</span>, 
         y <span class="op">=</span> <span class="st">"Riqueza observada"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">tema_livro</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-poi-pre"></span>
<img src="livro_files/figure-html/fig-mod-poi-pre-1.png" alt="Gráfico de dispersão para explorar as variáveis." width="100%" height="100%"><p class="caption">
Figura 8.1: Gráfico de dispersão para explorar as variáveis.
</p>
</div>
<p>Aqui vemos que há de fato uma relação linear positiva entre as duas variáveis.</p>
<ul>
<li>A partir de agora vamos sempre usar uma mesma estrutura para realizar nossos exercícios de modelagem:</li>
</ul>
<ol style="list-style-type: decimal">
<li>Primeiro vamos especificar o modelo</li>
<li>Depois realizar a diagnose</li>
<li>Por último realizar inferência a partir do nosso modelo</li>
</ol>
<p><strong>Modelagem</strong></p>
<p>O primeiro argumento da função <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> é uma fórmula, em que na parte esquerda temos a variável resposta seguida do símbolo <code>~</code> (lê-se: modelado em função de) seguido pelas variáveis preditoras. Aqui podemos usar uma ou mais variáveis e testar o seu efeito aditivo (usando o sinal de +) ou a interação entre elas (usando o sinal de *). Um bom resumo sobre como especificar o seu modelo pode ser encontrada <a href="https://ridiculas.wordpress.com/2012/07/23/semantica-para-descrever-modelos/">aqui neste blog</a>. Aqui optamos por um modelo bem simples modelando a riqueza de anfíbios apenas em função da distância para o fragmento mais próximo.</p>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Modelo</span>
<span class="va">mod_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Riqueza_obs</span> <span class="op">~</span> <span class="va">dfrag</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">fragmentos</span><span class="op">)</span></code></pre></div>
<p>Assim como modelos lineares que vimos no Capítulo <a href="cap7.html#cap7">7</a>, GLMs com distribuição de Poisson requerem que se realizem testes de pressupostos de normalidade e homogeneidade de variância dos resíduos, assim como sobredispersão e inflação de zeros.</p>
<p><strong>Diagnose básica dos resíduos do modelo</strong></p>
<p>Iremos realizar três diagnoses básicas dos GLMs, avaliando diferentes aspectos do modelo:</p>
<ol style="list-style-type: decimal">
<li>Homogeneidade da variância e normalidade dos resíduos</li>
<li>Sobredispersão (<em>Overdispersion</em>)</li>
<li>Inflação de zeros (<em>Zero-inflation</em>)</li>
</ol>
<p>Vamos começar avaliando a homogeneidade da variância e a normalidade dos resíduos (Figura <a href="cap8.html#fig:fig-mod-poi-diag-bas">8.2</a>).</p>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnose básica</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_pois</span><span class="op">)</span> </code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-poi-diag-bas"></span>
<img src="livro_files/figure-html/fig-mod-poi-diag-bas-1.png" alt="Diagnose básica dos resíduos do modelo GLM Poisson." width="100%" height="100%"><p class="caption">
Figura 8.2: Diagnose básica dos resíduos do modelo GLM Poisson.
</p>
</div>
<p>Vemos que as linhas vermelhas (que indicam a tendência dos dados) estão praticamente retas seguindo a linha pontilhada, sugerindo que existe homogeneidade de variância dos resíduos. Vemos também que nos quatro plots alguns dados, 1, 7 e 30 (referem-se às linhas do data frame) aparecem identificados, pois apresentam ligeiro desvio da normalidade e estão distantes da média. No entanto, não é algo para nos preocuparmos, pois não são valores muito extremos. Portanto, a diagnose básica indicou que o modelo com Poisson parece ser adequado para modelar estes dados, ao menos em termos de homogeneidade de variância.</p>
<p><strong>Diagnose avançada dos resíduos do modelo</strong></p>
<p>Alguns pacotes permitem calcular outros aspectos do modelo que facilitam a diagnose, ou seja, se podemos de fato confiar nos parâmetros estimados por eles, incluindo valores de significância. Um pressuposto importante dos modelos de contagem (incluindo Poisson) é a sobredispersão (<em>overdispersion</em>).</p>
<p>Vejamos como o pacote <code>DHARMa</code> funciona (Figura <a href="cap8.html#fig:fig-mod-poi-diag-avan">8.3</a>).</p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnose avançada</span>
<span class="va">simulationOutput</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/simulateResiduals.html">simulateResiduals</a></span><span class="op">(</span>fittedModel <span class="op">=</span> <span class="va">mod_pois</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-poi-diag-avan"></span>
<img src="livro_files/figure-html/fig-mod-poi-diag-avan-1.png" alt="Diagnose avançada dos resíduos do modelo GLM Poisson." width="100%" height="100%"><p class="caption">
Figura 8.3: Diagnose avançada dos resíduos do modelo GLM Poisson.
</p>
</div>
<p>O plot claramente indica que há problema com <em>overdispersion</em>, mas não em termos de desvios de normalidade (KS test) ou <em>outlier</em>, já que apenas o primeiro foi significativo (aparece em vermelho).</p>
<p><strong>Detectando e lidando com overdispersion</strong></p>
<p>O que é sobredispersão (<em>overdispersion</em>)? Ela ocorre quando a variância observada é muito maior do que aquela predita pelo modelo. Para modelos que utilizam a distribuição de Poisson, isso ocorre quando a variância aumenta com a média. Lembre-se de que esta distribuição tem apenas um único parâmetro para descrever tanto a média quanto a variância (<span class="math inline">\(\lambda\)</span>). Portanto, a variância tem de ser igual à média. No entanto, se a variância nos dados observados for muito maior do que a média, dizemos que há sobredispersão nos dados.</p>
<p>Existem duas formas de diagnosticar <em>overdispersion</em> que estão implementadas na maioria dos pacotes. Aqui vamos demonstrá-las usando as funções <code><a href="https://easystats.github.io/performance/reference/check_overdispersion.html">check_overdispersion()</a></code> e <code><a href="https://rdrr.io/pkg/DHARMa/man/testDispersion.html">testDispersion()</a></code> disponíveis nos pacotes <code>performance</code> e <code>DHARMa</code>, respectivamente.</p>
<p>A função <code><a href="https://rdrr.io/pkg/DHARMa/man/testDispersion.html">testDispersion()</a></code> do <code>DHARMa</code> utiliza um método de aleatorização dos resíduos para determinar se há <em>overdispersion</em> nos dados, cuja vantagem é que aborda diretamente a variação nos dados, ao invés de medir o ajuste do modelo em si, com outros testes (Figura <a href="cap8.html#fig:fig-mod-poi-over-dharma">8.4</a>).</p>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Overdispersion</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testDispersion.html">testDispersion</a></span><span class="op">(</span><span class="va">mod_pois</span><span class="op">)</span> <span class="co"># modelo tem overdispersion</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  DHARMa nonparametric dispersion test via sd of residuals fitted vs. simulated</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  simulationOutput</span>
<span class="co">#&gt; dispersion = 1.6489, p-value &lt; 2.2e-16</span>
<span class="co">#&gt; alternative hypothesis: two.sided</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-poi-over-dharma"></span>
<img src="livro_files/figure-html/fig-mod-poi-over-dharma-1.png" alt="Teste de overdispersion do pacote `DHARMa`." width="100%" height="100%"><p class="caption">
Figura 8.4: Teste de overdispersion do pacote <code>DHARMa</code>.
</p>
</div>
<p>Aqui temos um gráfico e o resultado novamente do teste de <em>overdispersion</em> (que já aparecia no gráfico anterior) mostrando que de fato há <em>overdispersion</em>: perceba que o valor de <em>P</em> é significativo. O gráfico nos mostra em cinza a distribuição dos resíduos aleatorizados e a linha vermelha o valor observado da estatística. Já que a linha está bem à direita da distribuição, isso indica <em>overdispersion</em>, se estivesse à esquerda seria o caso de <em>underdispersion</em>.</p>
<p>Agora vamos utilizar a função <code>check_overdisperion()</code> que utiliza uma distribuição chi-quadrado e o valor de <em>dispersion ratio</em> para testar a presença de <em>overdispersion</em> no modelo. Esse teste também pode ser feito com a função acima ao se especificar o argumento <code>type="PearsonChisq"</code>.</p>
<div class="sourceCode" id="cb294"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Testar a presença de overdispersion</span>
<span class="fu"><a href="https://easystats.github.io/performance/reference/check_overdispersion.html">check_overdispersion</a></span><span class="op">(</span><span class="va">mod_pois</span><span class="op">)</span> <span class="co"># modelo tem overdispersion</span>
<span class="co">#&gt; # Overdispersion test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;        dispersion ratio =  1.657</span>
<span class="co">#&gt;   Pearson's Chi-Squared = 62.951</span>
<span class="co">#&gt;                 p-value =  0.007</span></code></pre></div>
<p>Quando este resultado é significativo, como vimos na última linha acima, isso indica que há <em>overdispersion</em>.</p>
<p>Usando a função <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> podemos ter um resumo e descrição dos parâmetros do modelo.</p>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Resumo do modelo</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_pois</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = Riqueza_obs ~ dfrag, family = poisson(link = "log"), </span>
<span class="co">#&gt;     data = fragmentos)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -3.3467  -0.9110   0.0942   0.8336   2.2773  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)   2.3051     0.0500  46.101   &lt;2e-16 ***</span>
<span class="co">#&gt; dfrag         0.0718     0.0507   1.416    0.157    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for poisson family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 70.868  on 39  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 68.856  on 38  degrees of freedom</span>
<span class="co">#&gt; AIC: 235.29</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 4</span>

<span class="co">## Dispersion parameter</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">mod_pois</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/df.residual.html">df.residual</a></span><span class="op">(</span><span class="va">mod_pois</span><span class="op">)</span>
<span class="co">#&gt; [1] 1.81199</span></code></pre></div>
<p>Na parte de baixo do output da função <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> também podemos calcular o <em>dispersion parameter</em> dividindo o <em>residual deviance</em> pelos graus de liberdade dos resíduos. Esta é outra maneira fácil e rápida de detectar <em>overdispersion</em>. Neste exemplo, temos que <em>Dispersion parameter</em> = 1.8119903. Quando esse valor é próximo de 1, isso sugere que não há <em>overdispersion</em>. No entanto, se ele for maior que 1.5, isso sugere que o modelo sofre de <em>overdispersion</em> e que devemos usar outra distribuição, tal como a distribuição <strong>binomial negativa</strong>, por exemplo.</p>
<p>Além disso, uma outra forma de diagnosticar o modelo é calcular os resíduos de Pearson (resíduos normalizados), que é basicamente a raiz quadrada da variância da variável resposta.</p>
<p><strong>Inflação de zeros</strong></p>
<p>Qualquer das formas mostradas acima de diagnosticar <em>overdispersion</em> pode ser usada na maioria das vezes, com exceção de dados com muitos zeros (pouca variância). Por isso, devemos também testar se o nosso modelo sofre de inflação de zeros. Vejamos como isso funciona usando as funções <code><a href="https://easystats.github.io/performance/reference/check_zeroinflation.html">check_zeroinflation()</a></code> no pacote <code>performanace</code> e <code><a href="https://rdrr.io/pkg/DHARMa/man/testZeroInflation.html">testZeroInflation()</a></code> no pacote <code>DHARMa</code> (Figura <a href="cap8.html#fig:fig-mod-poi-over-zero">8.5</a>).</p>
<div class="sourceCode" id="cb296"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Inflação de zeros - performanace</span>
<span class="fu"><a href="https://easystats.github.io/performance/reference/check_zeroinflation.html">check_zeroinflation</a></span><span class="op">(</span><span class="va">mod_pois</span><span class="op">)</span> <span class="co"># para diagnosticar se o modelo sofre de zero inflation</span>
<span class="co">#&gt; Model has no observed zeros in the response variable.</span>
<span class="co">#&gt; NULL</span>

<span class="co">## Inflação de zeros - DHARMa</span>
<span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/testZeroInflation.html">testZeroInflation</a></span><span class="op">(</span><span class="va">mod_pois</span><span class="op">)</span> <span class="co"># para testar se existe zero inflation</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  DHARMa zero-inflation test via comparison to expected zeros with simulation under H0 = fitted model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  simulationOutput</span>
<span class="co">#&gt; ratioObsSim = NaN, p-value = 1</span>
<span class="co">#&gt; alternative hypothesis: two.sided</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-poi-over-zero"></span>
<img src="livro_files/figure-html/fig-mod-poi-over-zero-1.png" alt="Teste de inflação de zeros do pacote `DHARMa`." width="100%" height="100%"><p class="caption">
Figura 8.5: Teste de inflação de zeros do pacote <code>DHARMa</code>.
</p>
</div>
<p>Tanto a função do <code>DHARMa</code> quanto do <code>performance</code> conseguiram detectar que o modelo tem problemas com <em>overdispersion</em>, mas isso não é causado pelo excesso de zeros. Como já dissemos acima, no caso da distribuição Poisson, tanto a média quanto a variância são modeladas pelo mesmo parâmetro (<span class="math inline">\(\lambda\)</span>). Isso faz com que esta distribuição não seja muito útil para modelar dados de contagem em que haja muita variância em torno da média. Esse infelizmente é o caso da grande maioria dos dados ecológicos.</p>
<p>Por estes motivos, não podemos fazer inferência com este modelo porque os parâmetros estimados não são confiáveis. Mas vejamos como seria feita essa inferência <em>caso este modelo fosse adequado</em>.</p>
<p><strong>Inferência</strong></p>
<p>Aqui iremos apresentar várias funções para calcular o coeficiente de determinação (R<sup>2</sup>). No caso de GLM(M)s, não há um consenso sobre como se calcula este coeficiente, havendo várias propostas que utilizam maneiras diferentes de estimar a homogeneidade de variância e covariância entre observações dos resíduos, veja Nakagawa et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-nakagawa2017" role="doc-biblioref">2017</a>)</span> e Ives <span class="citation">(<a href="refer%C3%AAncias.html#ref-ives2015" role="doc-biblioref">2015</a>)</span> para maiores detalhes, assim como o <em>help</em> das respectivas funções.</p>
<div class="sourceCode" id="cb297"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Coeficientes estimados pelo modelo</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_pois</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = Riqueza_obs ~ dfrag, family = poisson(link = "log"), </span>
<span class="co">#&gt;     data = fragmentos)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -3.3467  -0.9110   0.0942   0.8336   2.2773  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)   2.3051     0.0500  46.101   &lt;2e-16 ***</span>
<span class="co">#&gt; dfrag         0.0718     0.0507   1.416    0.157    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for poisson family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 70.868  on 39  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 68.856  on 38  degrees of freedom</span>
<span class="co">#&gt; AIC: 235.29</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 4</span>

<span class="co">## Calculando o R2 do modelo</span>
<span class="fu"><a href="https://rdrr.io/pkg/MuMIn/man/r.squaredGLMM.html">r.squaredGLMM</a></span><span class="op">(</span><span class="va">mod_pois</span><span class="op">)</span>
<span class="co">#&gt;                  R2m        R2c</span>
<span class="co">#&gt; delta     0.04925800 0.04925800</span>
<span class="co">#&gt; lognormal 0.05154558 0.05154558</span>
<span class="co">#&gt; trigamma  0.04696308 0.04696308</span>
<span class="fu"><a href="https://rdrr.io/pkg/piecewiseSEM/man/rsquared.html">rsquared</a></span><span class="op">(</span><span class="va">mod_pois</span><span class="op">)</span>
<span class="co">#&gt;      Response  family link     method  R.squared</span>
<span class="co">#&gt; 1 Riqueza_obs poisson  log nagelkerke 0.04919844</span>
<span class="fu"><a href="https://easystats.github.io/performance/reference/r2.html">r2</a></span><span class="op">(</span><span class="va">mod_pois</span><span class="op">)</span>
<span class="co">#&gt; # R2 for Generalized Linear Regression</span>
<span class="co">#&gt;   Nagelkerke's R2: 0.059</span></code></pre></div>
<p>Podemos ver que os valores de R<sup>2</sup> são bem baixos (em torno de 4 - 5%), independentemente do método que usamos pra calculá-lo.</p>
<p><strong>Plot do modelo predito</strong></p>
<p>Vamos realizar a visualização do ajusto do modelo Poisson (Figura <a href="cap8.html#fig:fig-mod-poi-model">8.6</a>).</p>
<div class="sourceCode" id="cb298"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">fragmentos</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">dfrag</span>, <span class="va">Riqueza_obs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>cex <span class="op">=</span> <span class="fl">4</span>,alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"glm"</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span>, 
                method.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span>, se <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Distância para o fragmento mais próximo"</span>, 
         y <span class="op">=</span> <span class="st">"Riqueza observada"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">tema_livro</span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ggExtra/man/ggMarginal.html">ggMarginal</a></span><span class="op">(</span><span class="va">a1</span>, fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-poi-model"></span>
<img src="livro_files/figure-html/fig-mod-poi-model-1.png" alt="Gráfico do GLM Poisson." width="100%" height="100%"><p class="caption">
Figura 8.6: Gráfico do GLM Poisson.
</p>
</div>
<p><strong>Interpretação dos resultados</strong></p>
<p>Aqui vemos que há uma leve tendência na relação positiva entre distância para o fragmento mais próximo e a riqueza de anfíbios observada. No entanto, há uma grande dispersão nos dados ao redor da reta do modelo, fazendo com que a relação não seja de fato significativa e tenhamos um R<sup>2</sup> bem baixo. Caso pudéssemos confiar nos parâmetros deste modelo, poderíamos dizer que existe uma leve tendência a um aumento da riqueza observada de anfíbios anuros à medida que aumenta a distância da poça para o fragmento mais próximo.</p>
<div id="o-que-causa-a-overdispersion" class="section level3" number="8.4.1">
<h3>
<span class="header-section-number">8.4.1</span> O que causa a <em>overdispersion</em>?<a class="anchor" aria-label="anchor" href="#o-que-causa-a-overdispersion"><i class="fas fa-link"></i></a>
</h3>
<p>Existem dois conjuntos de causas: aparente ou real.</p>
<p>As causas aparentes são geradas pela má especificação do modelo, tais como:</p>
<ol style="list-style-type: decimal">
<li>não inclusão de covariáveis ou interações no modelo</li>
<li>presença de <em>outliers</em> na variável resposta</li>
<li>efeitos não lineares da covariável (X2, X3…)</li>
<li>escolha errada da função de ligação (<em>link function</em>)</li>
</ol>
<p>As causas reais incluem:</p>
<ol style="list-style-type: decimal">
<li>variância maior que a média</li>
<li>muitos zeros</li>
<li>agregação de observações</li>
<li>correlação entre observações (não independência)</li>
</ol>
</div>
<div id="o-que-fazer-se-seu-modelo-tiver-overdispersion" class="section level3" number="8.4.2">
<h3>
<span class="header-section-number">8.4.2</span> O que fazer se seu modelo tiver <em>overdispersion</em>?<a class="anchor" aria-label="anchor" href="#o-que-fazer-se-seu-modelo-tiver-overdispersion"><i class="fas fa-link"></i></a>
</h3>
<p>Depois de tentar corrigir possíveis más especificações, como as listadas acima, existem duas alternativas:</p>
<ol style="list-style-type: decimal">
<li>usar outra distribuição, tal como binomial negativa, caso o <em>dispersion parameter</em> seja maior que 15 ou 20</li>
<li>Usar um modelo com correção de erro da sobredispersão, caso 1.5 &lt; <em>dispersion</em> &gt; 15</li>
</ol>
<p>Geralmente, dados de contagem em estudos ecológicos não seguem uma distribuição Poisson, pois há muita dispersão (variância) nos dados. Logo, o pressuposto da distribuição Poisson, i.e., de que a média e variância são descritas por um mesmo parâmetro (<span class="math inline">\(\lambda\)</span>) é quebrado.</p>
<p>Como vimos, <em>overdispersion</em> é um problema comum ao analisar dados ecológicos e deve necessariamente ser diagnosticado no modelo. Uma maneira de lidar com esse tipo de problema é utilizar uma outra distribuição diferente da Poisson. A binomial negativa pode ser entendida como uma mistura das distribuições Poisson e Gamma, ou seja, ela aceita dados de contagem que sejam positivos maiores que zero. A grande vantagem desta distribuição é que, diferentemente da Poisson, ela tem um parâmetro para modelar a média (<span class="math inline">\(\lambda\)</span>) e outro para modelar a variância (<em>k</em>). Logo, ela permite modelar dados em que a média é diferente da variância. Vejamos um exemplo.</p>
<p>Aqui vamos continuar com estes dados para ver como o modelo se comporta com essa nova distribuição especificada. Para isso vamos utilizar a função <code>glm.nb</code> do pacote <code>MASS</code>.</p>
<p><strong>Modelagem</strong></p>
<div class="sourceCode" id="cb299"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Ajuste do modelo</span>
<span class="va">mod_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/glm.nb.html">glm.nb</a></span><span class="op">(</span><span class="va">Riqueza_obs</span> <span class="op">~</span> <span class="va">dfrag</span>, data <span class="op">=</span> <span class="va">fragmentos</span><span class="op">)</span></code></pre></div>
<p><strong>Diagnose resíduos</strong></p>
<p>Assim como fizemos com o modelo com Poisson, vamos agora diagnosticar os resíduos (Figura <a href="cap8.html#fig:fig-mod-nb-diag-bas">8.7</a>).</p>
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnose</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_nb</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="op">(</span><span class="va">chat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">mod_nb</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/df.residual.html">df.residual</a></span><span class="op">(</span><span class="va">mod_nb</span><span class="op">)</span><span class="op">)</span> <span class="co"># DISPERSION PARAMETER</span>
<span class="co">#&gt; [1] 1.126184</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-nb-diag-bas"></span>
<img src="livro_files/figure-html/fig-mod-nb-diag-bas-1.png" alt="Diagnose básica dos resíduos do modelo GLM binomial Negativo." width="100%" height="100%"><p class="caption">
Figura 8.7: Diagnose básica dos resíduos do modelo GLM binomial Negativo.
</p>
</div>
<p>Compare estes gráficos (Figura <a href="cap8.html#fig:fig-mod-nb-diag-bas">8.7</a>) com os do modelo anterior com distribuição Poisson (Figura <a href="cap8.html#fig:fig-mod-poi-diag-bas">8.2</a>). Eles são praticamente idênticos, ou seja, o modelo com Poisson já tinha homogeneidade de variância e não tinha problemas com normalidade dos resíduos. Agora vejamos se o problema com <em>overdispersion</em> foi resolvido (Figura <a href="cap8.html#fig:fig-mod-bn-diag-avan">8.8</a>).</p>
<div class="sourceCode" id="cb301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnose avançada</span>
<span class="va">simulationOutput</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/simulateResiduals.html">simulateResiduals</a></span><span class="op">(</span>fittedModel <span class="op">=</span> <span class="va">mod_nb</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-bn-diag-avan"></span>
<img src="livro_files/figure-html/fig-mod-bn-diag-avan-1.png" alt="Diagnose avançada dos resíduos do modelo GLM binomial Negativo." width="100%" height="100%"><p class="caption">
Figura 8.8: Diagnose avançada dos resíduos do modelo GLM binomial Negativo.
</p>
</div>
<p>Na diagnose do modelo pelo <code>DHARMa</code>, vemos que bastou mudar a distribuição de probabilidade que o problema de <em>overdispersion</em> foi resolvido (nenhum teste foi significativo no quadro da esquerda). Como já sabíamos, não há problemas com homogeneidade de variância (plot da direita mostrando a tendência entre o predito e resíduos pra cada quantil), nem de <em>outliers</em>. O <em>dispersion parameter</em> é mais próximo de 1 do que no modelo com Poisson. Agora sim podemos levar em conta o R<sup>2</sup>.</p>
<p><strong>Inferência</strong></p>
<div class="sourceCode" id="cb302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Coeficiente de determinação</span>
<span class="fu"><a href="https://rdrr.io/pkg/piecewiseSEM/man/rsquared.html">rsquared</a></span><span class="op">(</span><span class="va">mod_nb</span><span class="op">)</span>
<span class="co">#&gt;      Response                     family link     method  R.squared</span>
<span class="co">#&gt; 1 Riqueza_obs Negative Binomial(14.7068)  log nagelkerke 0.02935674</span></code></pre></div>
<p>Mas esse valor parece ser um pouco menor do que anteriormente. Perceba que aqui utilizamos somente uma das funções apresentadas anteriormente, já que se trata de um modelo GLM com binomial negativa, calculamos o R<sup>2</sup> pelo método de Nagelkerke.</p>
<p>Usando a função <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> podemos ter um resumo e descrição dos parâmetros do modelo.</p>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Coeficientes estimados pelo modelo</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_nb</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm.nb(formula = Riqueza_obs ~ dfrag, data = fragmentos, init.theta = 14.70679964, </span>
<span class="co">#&gt;     link = log)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -2.7569  -0.7068   0.0694   0.6194   1.6546  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)  2.30504    0.06481  35.567   &lt;2e-16 ***</span>
<span class="co">#&gt; dfrag        0.07248    0.06571   1.103     0.27    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for Negative Binomial(14.7068) family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 44.002  on 39  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 42.795  on 38  degrees of freedom</span>
<span class="co">#&gt; AIC: 231.68</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;               Theta:  14.71 </span>
<span class="co">#&gt;           Std. Err.:  8.62 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  2 x log-likelihood:  -225.68</span></code></pre></div>
<p><strong>Interpretação dos resultados</strong></p>
<p>Aqui vemos que a interpretação do resultado em termos de valor de <em>P</em> não mudou, ou seja, a distância para o fragmento mais próximo não foi significativa. Mas vejam que o coeficiente (<em>slope</em>) mudou um pouco, antes era 0.0718 (SE=0.0507) e com binomial negativa passa a ser 0.07248 (SE=0.06571).</p>
<p><strong>Plot do modelo predito</strong></p>
<p>Vamos realizar a visualização do ajuste do modelo binomial Negativo (Figura <a href="cap8.html#fig:fig-mod-nb-model">8.9</a>).</p>
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Gráfico</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">fragmentos</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">dfrag</span>, <span class="va">Riqueza_obs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"glm.nb"</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span>, se <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Distância para o fragmento mais próximo"</span>, 
         y <span class="op">=</span> <span class="st">"Riqueza observada"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">tema_livro</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-nb-model"></span>
<img src="livro_files/figure-html/fig-mod-nb-model-1.png" alt="Gráfico do GLM binomial Negativo." width="100%" height="100%"><p class="caption">
Figura 8.9: Gráfico do GLM binomial Negativo.
</p>
</div>
<p>Aqui vemos que a reta predita pelo modelo é muito similar ao que tivemos com o modelo Poisson. No entanto, agora que sabemos que este modelo com binomial negativa foi corretamente especificado e podemos confiar nos parâmetros estimados.</p>
</div>
</div>
<div id="dados-de-contagem-modelos-quasi-likelihood" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Dados de contagem: modelos quasi-likelihood<a class="anchor" aria-label="anchor" href="#dados-de-contagem-modelos-quasi-likelihood"><i class="fas fa-link"></i></a>
</h2>
<p>Como dissemos acima, uma outra alternativa para ajustar modelos GLM a dados de contagem são os chamados “quasi-likelihood”, tais como quasi-Poisson e quasi-binomial. Dependendo do valor do <em>dispersion parameter</em>, pode ser útil escolher este tipo de modelo. No entanto, eles vêm com uma desvantagem: não é possível calcular o valor de <em>Akaike Information Criterion</em> (AIC) porque estes modelos não retornam um valor de <em>likelihood</em> (verosimilhança). Este parâmetro é comumente utilizado em abordagens estatísticas de teoria da informação para selecionar o melhor modelo que se ajusta aos dados. Neste caso, precisamos utilizar outras funções disponíveis nos pacotes <code>MuMIn</code>, <code>AICcmodavg</code> e <code>bbmle</code> para calcular o QAIC. Para mais detalhes sobre esses modelos, veja o vignette sobre o assunto do pacote <code>bbmle</code>.</p>
<p><strong>Análise</strong></p>
<p>Aqui vamos apenas exemplificar como um modelo com distribuição quasi-poisson pode ser especificado.</p>
<div class="sourceCode" id="cb305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Modelo</span>
<span class="va">mod_quasipois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Riqueza_obs</span> <span class="op">~</span> <span class="va">dfrag</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">quasipoisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">fragmentos</span><span class="op">)</span></code></pre></div>
<p><strong>Diagnose dos resíduos</strong></p>
<p>A função <code>resid</code> não leva em conta a sobredispersão e temos de calcular manualmente o parâmetro de dispersão e inclui-lo no plot. Portanto, não podemos realizar a diagnose de modelos quasi-Poisson apenas com a função <code>plot</code> como fazíamos até agora. Então, calculamos primeiramente os resíduos de Pearson e depois dividindo-o pela raiz quadrada do parâmetro de dispersão (Figura <a href="cap8.html#fig:fig-mod-quasi-poi-diag">8.10</a>).</p>
<div class="sourceCode" id="cb306"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnose dos resíduos</span>
<span class="va">EP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_quasipois</span>, type <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span>
<span class="va">ED</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_quasipois</span>, type <span class="op">=</span> <span class="st">"deviance"</span><span class="op">)</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_quasipois</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
<span class="va">E</span> <span class="op">&lt;-</span> <span class="va">fragmentos</span><span class="op">$</span><span class="va">Riqueza_obs</span> <span class="op">-</span> <span class="va">mu</span>
<span class="va">EP2</span> <span class="op">&lt;-</span> <span class="va">E</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1.65662</span> <span class="op">*</span> <span class="va">mu</span><span class="op">)</span> <span class="co"># dispersion parameter da quasipoisson</span>
<span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mu</span>, y <span class="op">=</span> <span class="va">E</span>, main <span class="op">=</span> <span class="st">"Response residuals"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mu</span>, y <span class="op">=</span> <span class="va">EP</span>, main <span class="op">=</span> <span class="st">"Pearson residuals"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mu</span>, y <span class="op">=</span> <span class="va">EP2</span>, main <span class="op">=</span> <span class="st">"Pearson residuals scaled"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mu</span>, y <span class="op">=</span> <span class="va">ED</span>, main <span class="op">=</span> <span class="st">"Deviance residuals"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-quasi-poi-diag"></span>
<img src="livro_files/figure-html/fig-mod-quasi-poi-diag-1.png" alt="Diagnose dos resíduos do modelo GLM Quasi-Poisson." width="100%" height="100%"><p class="caption">
Figura 8.10: Diagnose dos resíduos do modelo GLM Quasi-Poisson.
</p>
</div>
<p>Aqui vemos que não existe um padrão claro nos resíduos, muito similar ao que tínhamos anteriormente. Devido às limitações de distribuições “quasi” e dado que já temos um modelo adequado com binomial negativa, sugerimos interpretar apenas o modelo anterior com binomial negativa.</p>
</div>
<div id="dados-de-contagem-a-distribuição-binomial" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> Dados de contagem: a distribuição binomial<a class="anchor" aria-label="anchor" href="#dados-de-contagem-a-distribui%C3%A7%C3%A3o-binomial"><i class="fas fa-link"></i></a>
</h2>
<p>Quando temos dados de proporção (e.g., número de doentes por 1000 habitantes) ou incidência (i.e., presença ou ausência), a distribuição mais adequada para modelar os dados é a distribuição binomial. No entanto, temos que especificar o modelo de acordo com o tipo dos dados no argumento <code>formula</code>. Vejamos dois exemplos.</p>
<div id="análise-com-dados-de-proporção" class="section level3" number="8.6.1">
<h3>
<span class="header-section-number">8.6.1</span> Análise com dados de proporção<a class="anchor" aria-label="anchor" href="#an%C3%A1lise-com-dados-de-propor%C3%A7%C3%A3o"><i class="fas fa-link"></i></a>
</h3>
<p>Neste exemplo, vamos ver como podemos modelar a proporção de células sanguíneas em função do tipo de tratamento.</p>
<p><strong>Explicação dos dados</strong></p>
<p>Este conjunto de dados foi coletado por <span class="citation">(<a href="refer%C3%AAncias.html#ref-Franco-Belussi2018a" role="doc-biblioref">Franco-Belussi, De Oliveira, and Sköld 2018</a>)</span>. Os autores utilizaram um desenho experimental típico de uma 2x5 ANOVA fatorial (ou <em>two-way</em> ANOVA) em que temos dois tratamentos (fatores): pigmentação do girino com dois níveis (Yes e No) e Tempo de exposição com cinco níveis (controle sem UV, 6 h, 12 h, 18 h e 24 h de exposição à UV).</p>
<p><strong>Pergunta</strong></p>
<p>A melanina protege girinos contra os efeitos da radiação ultravioleta?</p>
<p><strong>Predições</strong></p>
<p>Como a melanina participa do sistema imune inato, ela desempenharia um papel na resposta do organismo à radiação UV, auxiliando as células imunes a combater os seus efeitos deletérios.</p>
<p><strong>Variáveis</strong></p>
<ul>
<li>Variável resposta: Contagem diferencial de eosinófilos</li>
<li>data frame com 10 girinos em cada tratamento, totalizando 50 girinos</li>
</ul>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Dados</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">uv_cells</span><span class="op">)</span>
<span class="co">#&gt;     UV Pigmentation Total_Cell Lymphocyte Neutrophil Basophil Monocyte Eosinophil</span>
<span class="co">#&gt; 1 1.CT          Yes        100         80         18        0        0          2</span>
<span class="co">#&gt; 2 1.CT          Yes        100         74         17        6        0          3</span>
<span class="co">#&gt; 3 1.CT          Yes        100         78         22        0        0          0</span>
<span class="co">#&gt; 4 1.CT          Yes        100         87         13        0        0          0</span>
<span class="co">#&gt; 5 1.CT          Yes        100         74         21        1        0          4</span>
<span class="co">#&gt; 6 2.6h          Yes        100         95          4        0        0          1</span>

<span class="co">## Traduzir nomes das colunas e níveis de pigmentação </span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">uv_cells</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"UV"</span>, <span class="st">"Pigmentacao"</span>, <span class="st">"n_celulas"</span>, <span class="st">"linfocito"</span>, <span class="st">"neutrofilo"</span>, <span class="st">"basofilo"</span>, <span class="st">"monocito"</span>, <span class="st">"eosinofilo"</span><span class="op">)</span>
<span class="va">uv_cells</span><span class="op">$</span><span class="va">Pigmentacao</span><span class="op">[</span><span class="va">uv_cells</span><span class="op">$</span><span class="va">Pigmentacao</span><span class="op">==</span><span class="st">"Yes"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"sim"</span>
<span class="va">uv_cells</span><span class="op">$</span><span class="va">Pigmentacao</span><span class="op">[</span><span class="va">uv_cells</span><span class="op">$</span><span class="va">Pigmentacao</span><span class="op">==</span><span class="st">"No"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"nao"</span></code></pre></div>
<p>Vamos explorar os dados para tentar entender como são as relações (Figura <a href="cap8.html#fig:fig-mod-bin-pre">8.11</a>).</p>
<div class="sourceCode" id="cb308"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Gráfico</span>

<span class="co"># Calcular média e intervalo de confiança</span>
<span class="va">eosinofilo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rmisc/man/summarySE.html">summarySE</a></span><span class="op">(</span><span class="va">uv_cells</span>, 
                        measurevar <span class="op">=</span> <span class="st">"eosinofilo"</span>,
                        groupvars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"UV"</span>, <span class="st">"Pigmentacao"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Definir posição de linhas e pontos no gráfico</span>
<span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>

<span class="va">eosinofilo</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">UV</span>, y <span class="op">=</span> <span class="va">eosinofilo</span>, colour <span class="op">=</span> <span class="va">Pigmentacao</span>,
             group <span class="op">=</span> <span class="va">Pigmentacao</span>, fill <span class="op">=</span> <span class="va">Pigmentacao</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">eosinofilo</span><span class="op">-</span><span class="va">se</span>, ymax<span class="op">=</span><span class="va">eosinofilo</span> <span class="op">+</span><span class="va">se</span><span class="op">)</span>, 
                width<span class="op">=</span><span class="fl">.1</span>, size <span class="op">=</span> <span class="fl">1.1</span>, position<span class="op">=</span><span class="va">pd</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>position<span class="op">=</span><span class="va">pd</span>, size <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">21</span>, colour <span class="op">=</span> <span class="st">"black"</span>, position<span class="op">=</span><span class="va">pd</span>, size<span class="op">=</span><span class="fl">3.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkorange"</span>, <span class="st">"cyan4"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkorange"</span>, <span class="st">"cyan4"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"UV"</span>, y <span class="op">=</span> <span class="st">"Eosinófilo"</span>, fill<span class="op">=</span><span class="st">"Pigmentação"</span>, colour<span class="op">=</span><span class="st">"Pigmentação"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">tema_livro</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-bin-pre"></span>
<img src="livro_files/figure-html/fig-mod-bin-pre-1.png" alt="Gráfico para explorar as relações entre as variáveis." width="100%" height="100%"><p class="caption">
Figura 8.11: Gráfico para explorar as relações entre as variáveis.
</p>
</div>
<p>Aqui vemos que a quantidade de eosinófilos é muito maior nos girinos sem pigmentação (“albinos”). Já que estes animais não têm pigmentação melânica, as células brancas do sangue são a única ferramenta de combate aos efeitos deletérios da UV.</p>
<p><strong>Modelagem</strong></p>
<p>Aqui vamos usar o <code>cbind</code> no argumento <code>formula</code> para dizer que queremos modelar a contagem de eosinófilos em relação ao número total de células, ou seja, sua proporção. Aqui temos a contagem do número de eosinófilos (um tipo de célula da série branca do sangue) em lâminas histológicas de girinos da rã-touro (<em>Lithobates catesbeianus</em>) num total de 1000 células.</p>
<div class="sourceCode" id="cb309"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Modelo</span>
<span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html">cbind</a></span><span class="op">(</span><span class="va">eosinofilo</span>, <span class="va">n_celulas</span><span class="op">)</span> <span class="op">~</span> <span class="va">UV</span> <span class="op">*</span> <span class="va">Pigmentacao</span>, family <span class="op">=</span> <span class="va">binomial</span>, data <span class="op">=</span> <span class="va">uv_cells</span><span class="op">)</span></code></pre></div>
<p><strong>Diagnose básica dos resíduos do modelo</strong></p>
<p>Vamos fazer a diagnose básica dos resíduos do modelo (Figura <a href="cap8.html#fig:fig-mod-quasi-bin-diag-bas">8.12</a>).</p>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnose dos resíduos</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-quasi-bin-diag-bas"></span>
<img src="livro_files/figure-html/fig-mod-quasi-bin-diag-bas-1.png" alt="Diagnose básica dos resíduos do modelo GLM binomial." width="100%" height="100%"><p class="caption">
Figura 8.12: Diagnose básica dos resíduos do modelo GLM binomial.
</p>
</div>
<p>Parece que os resíduos não sofrem de heterogeneidade de variância (linha vermelha está reta), mas parece haver um pequeno desvio da normalidade (veja pontos 19, 29 e 32 destacados no plot de quantis e no de outliers). Vejamos o que o <code>DHARMa</code> nos diz (Figura <a href="cap8.html#fig:fig-mod-quasi-bin-diag-avan">8.13</a>).</p>
<div class="sourceCode" id="cb311"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnose avançada</span>
<span class="va">simulationBion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/simulateResiduals.html">simulateResiduals</a></span><span class="op">(</span>fittedModel <span class="op">=</span> <span class="va">mod1</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-quasi-bin-diag-avan"></span>
<img src="livro_files/figure-html/fig-mod-quasi-bin-diag-avan-1.png" alt="Diagnose avançada dos resíduos do modelo GLM binomial." width="100%" height="100%"><p class="caption">
Figura 8.13: Diagnose avançada dos resíduos do modelo GLM binomial.
</p>
</div>
<p>Agora vamos checar a qualidade do modelo com base na distribuição dos resíduos (Figura <a href="#fig:fig-mod-quasi-bin-diag-avan1"><strong>??</strong></a>).</p>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnose avançada</span>
<span class="fu"><a href="https://easystats.github.io/performance/reference/binned_residuals.html">binned_residuals</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span>
<span class="co">#&gt; Warning: Probably bad model fit. Only about 14% of the residuals are inside the error bounds.</span></code></pre></div>
<p>Aqui já não resta dúvidas de que os resíduos deste modelo sofrem tanto com heterogeneidade de variância, quanto <em>overdispersion</em> e problemas com <em>outliers</em>. Provavelmente o problema com <em>outliers</em> ocorreu por conta do pequeno tamanho amostral.</p>
<p><strong>Inferência</strong></p>
<p>Sabemos que o modelo não parece ser adequado para os dados, mas vamos interpretá-lo mesmo assim para que possamos entender a saída da função <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> e os contrastes entre os níveis dos fatores.</p>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Coeficientes estimados pelo modelo</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = cbind(eosinofilo, n_celulas) ~ UV * Pigmentacao, </span>
<span class="co">#&gt;     family = binomial, data = uv_cells)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -5.4165  -2.5266  -1.0148   0.8068   8.8233  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                        Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)            -1.84516    0.12107 -15.241  &lt; 2e-16 ***</span>
<span class="co">#&gt; UV2.6h                 -0.17979    0.17835  -1.008   0.3134    </span>
<span class="co">#&gt; UV3.12h                 0.38414    0.15899   2.416   0.0157 *  </span>
<span class="co">#&gt; UV4.18h                -0.49825    0.19363  -2.573   0.0101 *  </span>
<span class="co">#&gt; UV5.24h                -0.39916    0.18848  -2.118   0.0342 *  </span>
<span class="co">#&gt; Pigmentacaosim         -2.17222    0.35745  -6.077 1.22e-09 ***</span>
<span class="co">#&gt; UV2.6h:Pigmentacaosim  -0.07152    0.53831  -0.133   0.8943    </span>
<span class="co">#&gt; UV3.12h:Pigmentacaosim -0.38414    0.50150  -0.766   0.4437    </span>
<span class="co">#&gt; UV4.18h:Pigmentacaosim  1.13424    0.45981   2.467   0.0136 *  </span>
<span class="co">#&gt; UV5.24h:Pigmentacaosim  0.68684    0.48370   1.420   0.1556    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 737.36  on 49  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 460.85  on 40  degrees of freedom</span>
<span class="co">#&gt; AIC: 610.35</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 5</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span>
<span class="co">#&gt; Analysis of Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: binomial, link: logit</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Response: cbind(eosinofilo, n_celulas)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Terms added sequentially (first to last)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                Df Deviance Resid. Df Resid. Dev</span>
<span class="co">#&gt; NULL                              49     737.36</span>
<span class="co">#&gt; UV              4   26.034        45     711.32</span>
<span class="co">#&gt; Pigmentacao     1  235.682        44     475.64</span>
<span class="co">#&gt; UV:Pigmentacao  4   14.789        40     460.85</span></code></pre></div>
<p>Aqui temos tanto a tabela com os resultados por níveis dos fatores (<code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>), quanto a tabela com a <em>Deviance</em> que mostra os fatores e suas interações (<code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code>). Vemos que nenhum fator foi significativo. Caso houvesse algum fator significativo, poderíamos testar a significância de cada nível dos fatores usando contrastes, desta forma:</p>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Parâmetros</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html">pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/emmeans/man/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mod1</span>, <span class="op">~</span> <span class="va">UV</span><span class="op">|</span><span class="va">Pigmentacao</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Pigmentacao = nao:</span>
<span class="co">#&gt;  contrast      estimate    SE  df z.ratio p.value</span>
<span class="co">#&gt;  1.CT - 2.6h     0.1798 0.178 Inf   1.008  0.8518</span>
<span class="co">#&gt;  1.CT - 3.12h   -0.3841 0.159 Inf  -2.416  0.1109</span>
<span class="co">#&gt;  1.CT - 4.18h    0.4982 0.194 Inf   2.573  0.0753</span>
<span class="co">#&gt;  1.CT - 5.24h    0.3992 0.188 Inf   2.118  0.2124</span>
<span class="co">#&gt;  2.6h - 3.12h   -0.5639 0.167 Inf  -3.384  0.0064</span>
<span class="co">#&gt;  2.6h - 4.18h    0.3185 0.200 Inf   1.593  0.5021</span>
<span class="co">#&gt;  2.6h - 5.24h    0.2194 0.195 Inf   1.125  0.7933</span>
<span class="co">#&gt;  3.12h - 4.18h   0.8824 0.183 Inf   4.824  &lt;.0001</span>
<span class="co">#&gt;  3.12h - 5.24h   0.7833 0.177 Inf   4.414  0.0001</span>
<span class="co">#&gt;  4.18h - 5.24h  -0.0991 0.209 Inf  -0.474  0.9897</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Pigmentacao = sim:</span>
<span class="co">#&gt;  contrast      estimate    SE  df z.ratio p.value</span>
<span class="co">#&gt;  1.CT - 2.6h     0.2513 0.508 Inf   0.495  0.9879</span>
<span class="co">#&gt;  1.CT - 3.12h    0.0000 0.476 Inf   0.000  1.0000</span>
<span class="co">#&gt;  1.CT - 4.18h   -0.6360 0.417 Inf  -1.525  0.5461</span>
<span class="co">#&gt;  1.CT - 5.24h   -0.2877 0.445 Inf  -0.646  0.9675</span>
<span class="co">#&gt;  2.6h - 3.12h   -0.2513 0.508 Inf  -0.495  0.9879</span>
<span class="co">#&gt;  2.6h - 4.18h   -0.8873 0.454 Inf  -1.957  0.2876</span>
<span class="co">#&gt;  2.6h - 5.24h   -0.5390 0.480 Inf  -1.123  0.7942</span>
<span class="co">#&gt;  3.12h - 4.18h  -0.6360 0.417 Inf  -1.525  0.5461</span>
<span class="co">#&gt;  3.12h - 5.24h  -0.2877 0.445 Inf  -0.646  0.9675</span>
<span class="co">#&gt;  4.18h - 5.24h   0.3483 0.382 Inf   0.911  0.8928</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results are given on the log odds ratio (not the response) scale. </span>
<span class="co">#&gt; P value adjustment: tukey method for comparing a family of 5 estimates</span></code></pre></div>
<p>Aqui temos o valor de cada combinação de níveis dos fatores, com seu respectivo valor de contraste e o valor de <em>P</em>. Vemos que para girinos sem pigmentação, apenas três contrastes foram significativos.</p>
<p><strong>Plot do modelo predito</strong></p>
<p>Vamos realizar a visualização do ajuste do modelo binomial (Figura <a href="cap8.html#fig:fig-mod-bin-model">8.14</a>).</p>
<div class="sourceCode" id="cb315"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">uv_cells</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">UV</span>, <span class="va">eosinofilo</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Pigmentacao</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">16</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html">position_jitter</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkorange"</span>, <span class="st">"cyan4"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">tema_livro</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-bin-model"></span>
<img src="livro_files/figure-html/fig-mod-bin-model-1.png" alt="Gráfico do GLM binomial." width="100%" height="100%"><p class="caption">
Figura 8.14: Gráfico do GLM binomial.
</p>
</div>
<p>Usando o <code><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin()</a></code>, podemos perceber que existe uma dispersão maior nos tratamentos que utilizaram girinos sem pigmentação do que nos tratamentos com girinos pigmentados.</p>
</div>
</div>
<div id="análise-com-dados-de-incidência" class="section level2" number="8.7">
<h2>
<span class="header-section-number">8.7</span> Análise com dados de incidência<a class="anchor" aria-label="anchor" href="#an%C3%A1lise-com-dados-de-incid%C3%AAncia"><i class="fas fa-link"></i></a>
</h2>
<p>Uma outra aplicação da distribuição binomial é quando temos dados de incidência, ou seja, presença ou ausência, de alguma variável. Por exemplo, presença ou ausência de uma espécie ou indivíduo num local. Neste caso a <code>formula</code> é diferente e o modelo é similar a uma regressão logística, vejamos.</p>
<p>Aqui vamos utilizar os dados sobre autotomia da cauda de lagartos da espécie <em>Coleodactylus meridionalis</em> observados em fragmentos florestais da Mata Atlântica no estado de Pernambuco <span class="citation">(<a href="refer%C3%AAncias.html#ref-oliveira2020" role="doc-biblioref">C. N. Oliveira et al. 2020</a>)</span>.</p>
<p><strong>Pergunta</strong></p>
<p>A probabilidade de lagartos da espécie <em>Coleodactylus meridionalis</em> perderem (autotomizarem) a cauda aumenta com o tamanho do corpo e de acordo com o sexo dos lagartos?</p>
<p><strong>Predições</strong></p>
<p>Quanto maior o lagarto, maior a probabilidade de autotomia da cauda e que esta resposta poderia também diferir entre sexos devido ao dimorfismo sexual.</p>
<p><strong>Variáveis</strong></p>
<ul>
<li>Variável resposta: Presença ou ausência de cauda autotomizada em lagartos encontrados por busca ativa</li>
</ul>
<p><strong>Exploração dos dados</strong></p>
<p>Este conjunto de dados possui muitas entradas faltantes (codificadas como <code>NA</code>). Primeiro vamos visualizar o conjunto de dados e depois precisamos remover as linhas que contêm dados faltantes. Aqui podemos usar a função interna do <code><a href="https://ggplot2.tidyverse.org/reference/remove_missing.html">ggplot2::remove_missing()</a></code> para remover linhas cujas variáveis informadas no argumento estejam faltando, vejamos (Figura <a href="cap8.html#fig:fig-mod-inc-na">8.15</a>).</p>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">## Traduzir nomes das colunas e níveis de pigmentação </span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lagartos</span><span class="op">)</span>
<span class="co">#&gt;   Numero    Sex   SVL Intact_tail_length Autotomized_tail_length Tail_state</span>
<span class="co">#&gt; 1      2   Male 20.70                 NA                   12.88          0</span>
<span class="co">#&gt; 2      3   Male 21.10                 NA                   13.07          0</span>
<span class="co">#&gt; 3      6 Female 23.72                 NA                   17.56          0</span>
<span class="co">#&gt; 4      9   Male 18.84              17.38                      NA          1</span>
<span class="co">#&gt; 5     21   Male 22.20                 NA                   16.50          0</span>
<span class="co">#&gt; 6     22   &lt;NA&gt; 20.59                 NA                   12.46          0</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">lagartos</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"numero"</span>, <span class="st">"sexo"</span>, <span class="st">"SVL"</span>, <span class="st">"comprimento_cauda"</span>, <span class="st">"cauda_autotomizada"</span>, <span class="st">"estado_cauda"</span><span class="op">)</span>

<span class="co">## Dados faltantes</span>
<span class="fu"><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html">vis_miss</a></span><span class="op">(</span><span class="va">lagartos</span>, cluster <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-inc-na"></span>
<img src="livro_files/figure-html/fig-mod-inc-na-1.png" alt="Gráficos para explorar os dados faltantes." width="100%" height="100%"><p class="caption">
Figura 8.15: Gráficos para explorar os dados faltantes.
</p>
</div>
<p>Reparem que estão faltando 22.9% dos dados. Vamos excluir as linhas com os dados faltantes para a variável <code>sex</code> (Figura <a href="cap8.html#fig:fig-mod-inc-na1">8.16</a>).</p>
<div class="sourceCode" id="cb317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Removendo dados faltantes</span>
<span class="va">dados_semNA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/remove_missing.html">remove_missing</a></span><span class="op">(</span><span class="va">lagartos</span>, vars <span class="op">=</span> <span class="st">"sexo"</span><span class="op">)</span> 

<span class="co">## Visualizar</span>
<span class="fu"><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html">vis_miss</a></span><span class="op">(</span><span class="va">dados_semNA</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-inc-na1"></span>
<img src="livro_files/figure-html/fig-mod-inc-na1-1.png" alt="Gráficos para explorar os dados faltantes." width="100%" height="100%"><p class="caption">
Figura 8.16: Gráficos para explorar os dados faltantes.
</p>
</div>
<p>Agora, seguindo o que já estamos acostumados a fazer, vamos visualisar os dados com a nossa hipótese (Figura <a href="cap8.html#fig:fig-mod-inc-pre">8.17</a>).</p>
<div class="sourceCode" id="cb318"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Gráfico</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dados_semNA</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">SVL</span>, <span class="va">estado_cauda</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="va">sexo</span>, colour <span class="op">=</span> <span class="va">sexo</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"glm"</span>, method.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Estado da Cauda"</span>, x <span class="op">=</span> <span class="st">"Comprimento Rostro-Cloacal (mm)"</span>, shape <span class="op">=</span> <span class="st">"Sexo"</span>, colour <span class="op">=</span> <span class="st">"Sexo"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">tema_livro</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-inc-pre"></span>
<img src="livro_files/figure-html/fig-mod-inc-pre-1.png" alt="Gráfico para explorar as relações entre as variáveis." width="100%" height="100%"><p class="caption">
Figura 8.17: Gráfico para explorar as relações entre as variáveis.
</p>
</div>
<p><strong>Modelagem</strong></p>
<p>Aqui vamos construir dois modelos com a mesma distribuição binomial, mas com dois <em>link function</em>: logit e probit. A função logit possui caudas um pouco mais achatadas, isto é, a curva probit se aproxima dos eixos mais rapidamente que a logit. Geralmente não há muita diferença entre elas. Como não temos nenhuma expectativa de qual <em>link function</em> é o melhor, podemos fazer uma seleção de modelos.</p>
<div class="sourceCode" id="cb319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Modelos</span>
<span class="va">mod_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">estado_cauda</span> <span class="op">~</span> <span class="va">SVL</span> <span class="op">*</span> <span class="va">sexo</span>, data <span class="op">=</span> <span class="va">dados_semNA</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span>
<span class="va">mod_pro</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">estado_cauda</span> <span class="op">~</span> <span class="va">SVL</span> <span class="op">*</span> <span class="va">sexo</span>, data <span class="op">=</span> <span class="va">dados_semNA</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"probit"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Seleção de modelos</span>
<span class="fu"><a href="https://rdrr.io/pkg/bbmle/man/ICtab.html">AICctab</a></span><span class="op">(</span><span class="va">mod_log</span>, <span class="va">mod_pro</span>, nobs <span class="op">=</span> <span class="fl">139</span><span class="op">)</span>
<span class="co">#&gt;         dAICc df</span>
<span class="co">#&gt; mod_pro 0.0   4 </span>
<span class="co">#&gt; mod_log 0.1   4</span></code></pre></div>
<p>Existe pouca diferença entre o modelo probit e logit. Como o modelo logit é mais simples vamos interpretá-lo apenas.</p>
<p><strong>Diagnose dos resíduos do modelo</strong></p>
<p>Vamos fazer a diagnose dos resíduos do modelo (Figura <a href="cap8.html#fig:fig-mod-inc-diag">8.18</a>).</p>
<div class="sourceCode" id="cb320"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnóse avançada</span>
<span class="va">simulationBion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/simulateResiduals.html">simulateResiduals</a></span><span class="op">(</span>fittedModel <span class="op">=</span> <span class="va">mod_log</span>, plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-inc-diag"></span>
<img src="livro_files/figure-html/fig-mod-inc-diag-1.png" alt="Diagnose avançada dos resíduos do modelo GLM binomial de incidência." width="100%" height="100%"><p class="caption">
Figura 8.18: Diagnose avançada dos resíduos do modelo GLM binomial de incidência.
</p>
</div>
<p>Vamos realizar a visualização do ajusto do modelo (Figura <a href="#fig:fig-mod-inc-diag1"><strong>??</strong></a>).</p>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnóse avançada</span>
<span class="fu"><a href="https://easystats.github.io/performance/reference/binned_residuals.html">binned_residuals</a></span><span class="op">(</span><span class="va">mod_log</span><span class="op">)</span>
<span class="co">#&gt; Warning: About 92% of the residuals are inside the error bounds (~95% or higher would be good).</span></code></pre></div>
<p><strong>Inferência</strong></p>
<p>Para modelos com parâmetro de dispersão conhecida (e.g., binomial e Poisson), o chi-quadrado é a estatística mais apropriada.</p>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Coeficientes estimados pelo modelo</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_log</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = estado_cauda ~ SVL * sexo, family = binomial(link = "logit"), </span>
<span class="co">#&gt;     data = dados_semNA)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -1.5694  -1.0449  -0.8196   1.2181   1.6310  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)  </span>
<span class="co">#&gt; (Intercept)    5.5834     2.5909   2.155   0.0312 *</span>
<span class="co">#&gt; SVL           -0.2678     0.1178  -2.274   0.0230 *</span>
<span class="co">#&gt; sexoMale       0.6977     4.4055   0.158   0.8742  </span>
<span class="co">#&gt; SVL:sexoMale  -0.0442     0.2085  -0.212   0.8321  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 191.07  on 138  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 181.38  on 135  degrees of freedom</span>
<span class="co">#&gt; AIC: 189.38</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 4</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">mod_log</span>, test <span class="op">=</span> <span class="st">"Chisq"</span> <span class="op">)</span>
<span class="co">#&gt; Analysis of Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: binomial, link: logit</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Response: estado_cauda</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Terms added sequentially (first to last)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;          Df Deviance Resid. Df Resid. Dev Pr(&gt;Chi)   </span>
<span class="co">#&gt; NULL                       138     191.07            </span>
<span class="co">#&gt; SVL       1   9.2563       137     181.82 0.002347 **</span>
<span class="co">#&gt; sexo      1   0.3920       136     181.43 0.531262   </span>
<span class="co">#&gt; SVL:sexo  1   0.0454       135     181.38 0.831292   </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p><strong>Interpretação dos resultados</strong></p>
<p>A interpretação dos resultados é que o tamanho de corpo (SVL) afeta negativamente a probabilidade da cauda estar intacta, i.e., com o aumento do tamanho, a probabilidade da cauda permanecer intacta diminui. A interação não foi significativa, então o efeito é independente do sexo dos lagartos.</p>
</div>
<div id="dados-de-contagem-com-excesso-de-zeros" class="section level2" number="8.8">
<h2>
<span class="header-section-number">8.8</span> Dados de contagem com excesso de zeros<a class="anchor" aria-label="anchor" href="#dados-de-contagem-com-excesso-de-zeros"><i class="fas fa-link"></i></a>
</h2>
<p>Quando se analisa a abundância ou riqueza de espécies é comum que tenhamos dados com muitos zeros. Esse fenômeno pode ser causado por vários processos ecológicos, tais como locais fora do nicho da espécie, falha na detecção, amostras feitas fora do habitat ou em locais onde não se espera encontrar a espécie <span class="citation">(<a href="refer%C3%AAncias.html#ref-blascomoreno2019" role="doc-biblioref">Blasco‐Moreno et al. 2019</a>)</span>. Esse tipo de dado é problemático porque rompe com os pressupostos da distribuição Poisson e binomial negativa, podendo inclusive ser uma das causas da <em>overdispersion</em>.</p>
<p>Nesses casos, temos de ajustar modelos que levam em conta esse excesso de zeros nos dados. Esses modelos são chamados de <strong>zero-inflated</strong> e <strong>hurdle models</strong> (também chamados de <em>zero-altered models</em>), dependendo de como o processo que causou os zeros é modelado.</p>
<p><em>Hurdle models</em> (ou <em>zero-altered models</em>) modelam os dados dividindo-os em dois subconjuntos: um no qual reduzimos os dados à presença-ausência, ou seja, todos os dados maiores que 1 são transformados em 1 e usamos, por exemplo, uma distribuição binomial; e uma outra parte que só considera os valores positivos sem zero, utilizando uma Poisson ou binomial negativa truncadas. Ao fazer isso, a distribuição truncada assume que os zeros são gerados tanto por processos ecológicos, quanto erros de amostragem (ou seja, é impossível distinguir entre essas duas fontes). Portanto, esses zeros são excluídos da distribuição com dados de contagem. Por exemplo, se uma distribuição binomial negativa for usada para modelar a parte quantitativa, chamamos o modelo de <em>Zero-altered Negative binomial</em>. A interpretação dos modelos deve ser feita de forma conjunta.</p>
<p>Modelos com zero inflados funcionam de maneira similar, mas permitem que a distribuição Poisson contenha zeros, ou seja, <em>não é utilizada uma distribuição truncada</em>. Ao fazer isso, está distribuição de Poisson pressupõe que os zeros foram gerados por um processo ecológico real, tal como, ausência de habitat adequado.</p>
<p>Para ilustrar como podemos lidar com conjuntos de dados complexos, vamos utilizar os dados do parasita <em>Raillietiella mottae</em> infectando duas espécies de lagartos que ocorrem no Nordeste Brasileiro <span class="citation">(<a href="refer%C3%AAncias.html#ref-lima2018" role="doc-biblioref">Lima et al. 2018</a>)</span>. Ao todo, 63 indivíduos de <em>Hemidactylus agrius</em> e 132 de <em>Phyllopezus pollicaris</em> foram amostrados.</p>
<p><strong>Pergunta</strong></p>
<p>Quais atributos de história de vida dos lagartos são relacionados com o volume (<em>load</em>) de infecção, tais como tamanho e sexo?</p>
<p><strong>Predições</strong></p>
<p>Quanto maior o lagarto, maior o número de parasitas encontrados, esta resposta poderia também diferir entre sexos devido ao dimorfismo sexual.</p>
<p><strong>Variáveis</strong></p>
<ul>
<li>Variável resposta: número do parasita <em>Raillietiella mottae</em>, que é um crustáceo parasita, infectando o aparelho respiratório e intestinal de lagartos.</li>
</ul>
<div class="sourceCode" id="cb323"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Cabeçalho dos dados</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">parasitas</span><span class="op">)</span>
<span class="co">#&gt;                     Especie Sexo CRC Raillietiella_mottae</span>
<span class="co">#&gt; W124 Phyllopezus_pollicaris    F  61                    3</span>
<span class="co">#&gt; W125 Phyllopezus_pollicaris    F  56                    0</span>
<span class="co">#&gt; W127 Phyllopezus_pollicaris    M  61                    0</span>
<span class="co">#&gt; W128 Phyllopezus_pollicaris    M  48                    0</span>
<span class="co">#&gt; W129 Phyllopezus_pollicaris    F  40                    0</span>
<span class="co">#&gt; W130 Phyllopezus_pollicaris    M  62                    0</span></code></pre></div>
<p>Vamos explorar os dados (Figura <a href="cap8.html#fig:fig-mod-zero-pre">8.19</a>).</p>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Gráficos</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">parasitas</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Raillietiella_mottae</span>, fill <span class="op">=</span> <span class="va">Especie</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">Especie</span> <span class="op">~</span> <span class="va">Sexo</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkorange"</span>, <span class="st">"cyan4"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">tema_livro</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">parasitas</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">CRC</span>, <span class="va">Raillietiella_mottae</span>, fill <span class="op">=</span> <span class="va">Especie</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, shape <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">Sexo</span> <span class="op">~</span> <span class="va">Especie</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkorange"</span>, <span class="st">"cyan4"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Comprimento Rostro-Cloacal"</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="st">"Raillietiella mottae"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">tema_livro</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-zero-pre"></span>
<img src="livro_files/figure-html/fig-mod-zero-pre-1.png" alt="Gráfico para explorar as relações entre as variáveis." width="100%" height="100%"><img src="livro_files/figure-html/fig-mod-zero-pre-2.png" alt="Gráfico para explorar as relações entre as variáveis." width="100%" height="100%"><p class="caption">
Figura 8.19: Gráfico para explorar as relações entre as variáveis.
</p>
</div>
<p>Os gráfico acima mostram a contagem do parasita <em>Raillietiella mottae</em> nos dois sexos (F e M para fêmea e macho) nas duas espécies de lagartos (<em>Hemidactylus agrius</em> e <em>Phyllopezus pollicaris</em>), tanto na forma de uma distribuição de densidade, quanto de gráfico de dispersão. Aqui podemos ver que de fato existe um excesso de zeros principalmente em <em>P. pollicaris</em>.</p>
<p>Quando nos deparamos com dados complexos assim, a estratégia é sempre começar com um modelo simples e depois adicionar mais parâmetros. Portanto, vamos iniciar com um modelo Poisson, mesmo sabendo que ele muito provavelmente não será adequado para modelar estes dados.</p>
<p><strong>Modelagem</strong></p>
<p>Ajuste do modelo Poisson.</p>
<div class="sourceCode" id="cb325"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Modelo</span>
<span class="va">pois_plain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Raillietiella_mottae</span> <span class="op">~</span> <span class="va">CRC</span> <span class="op">+</span> <span class="va">Sexo</span> <span class="op">*</span> <span class="va">Especie</span>, data <span class="op">=</span> <span class="va">parasitas</span>, family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></code></pre></div>
<p><strong>Diagnose</strong></p>
<p>Aqui vamos utilizar as funções do pacote <code>performance</code> para o GLM Poisson.</p>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnose avançada</span>
<span class="co"># Verificar zero inflation</span>
<span class="fu"><a href="https://easystats.github.io/performance/reference/check_zeroinflation.html">check_zeroinflation</a></span><span class="op">(</span><span class="va">pois_plain</span><span class="op">)</span> <span class="co"># para diagnosticar se o modelo sofre de zero inflation</span>
<span class="co">#&gt; # Check for zero-inflation</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Observed zeros: 156</span>
<span class="co">#&gt;   Predicted zeros: 140</span>
<span class="co">#&gt;             Ratio: 0.90</span>

<span class="co"># Verificar overdispersion</span>
<span class="fu"><a href="https://easystats.github.io/performance/reference/check_overdispersion.html">check_overdispersion</a></span><span class="op">(</span><span class="va">pois_plain</span><span class="op">)</span>
<span class="co">#&gt; # Overdispersion test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;        dispersion ratio =   1.932</span>
<span class="co">#&gt;   Pearson's Chi-Squared = 367.133</span>
<span class="co">#&gt;                 p-value = &lt; 0.001</span></code></pre></div>
<p>A diagnose não só nos disse que o modelo possui <em>overdispersion</em>, como também de <em>zero-inflation</em>, como já esperávamos. Vejamos então como melhorar o nosso modelo para lidar com esses dois problemas. Especificamente, vamos utilizar um modelo <em>Hurdle</em> com binomial negativa truncada (ou seja, desconsiderando os zeros), e dois outros modelos com <em>zero-inflated</em> usando distribuição binomial negativa e Poisson. Aqui vamos utilizar o pacote <code>glmmTMB</code>.</p>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Modelos</span>
<span class="co"># Hurdle model</span>
<span class="va">hur_NB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html">glmmTMB</a></span><span class="op">(</span><span class="va">Raillietiella_mottae</span> <span class="op">~</span> <span class="va">CRC</span> <span class="op">+</span> <span class="va">Sexo</span> <span class="op">*</span> <span class="va">Especie</span>, zi <span class="op">=</span> <span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">parasitas</span>, family <span class="op">=</span> <span class="va">truncated_nbinom2</span><span class="op">)</span> 

<span class="co"># zero-inflated Poisson</span>
<span class="va">ziNB_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html">glmmTMB</a></span><span class="op">(</span><span class="va">Raillietiella_mottae</span> <span class="op">~</span> <span class="va">CRC</span> <span class="op">+</span> <span class="va">Sexo</span> <span class="op">*</span> <span class="va">Especie</span>, zi <span class="op">=</span> <span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">parasitas</span>, family <span class="op">=</span> <span class="va">nbinom2</span><span class="op">)</span> 

<span class="co"># zero-inflated Negative binomial</span>
<span class="va">ziP_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html">glmmTMB</a></span><span class="op">(</span><span class="va">Raillietiella_mottae</span> <span class="op">~</span> <span class="va">CRC</span> <span class="op">+</span> <span class="va">Sexo</span> <span class="op">*</span> <span class="va">Especie</span>, zi <span class="op">=</span> <span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">parasitas</span>, family <span class="op">=</span> <span class="va">poisson</span><span class="op">)</span> </code></pre></div>
<p><strong>Diagnose</strong></p>
<p>Vamos fazer a diagnose desses três modelos ajustados anteriormente.</p>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnose de inflação de zeros</span>
<span class="fu"><a href="https://easystats.github.io/performance/reference/check_zeroinflation.html">check_zeroinflation</a></span><span class="op">(</span><span class="va">hur_NB</span><span class="op">)</span> 
<span class="co">#&gt; # Check for zero-inflation</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Observed zeros: 156</span>
<span class="co">#&gt;   Predicted zeros: 157</span>
<span class="co">#&gt;             Ratio: 1.01</span>
<span class="fu"><a href="https://easystats.github.io/performance/reference/check_zeroinflation.html">check_zeroinflation</a></span><span class="op">(</span><span class="va">ziP_mod2</span><span class="op">)</span>
<span class="co">#&gt; # Check for zero-inflation</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Observed zeros: 156</span>
<span class="co">#&gt;   Predicted zeros: 140</span>
<span class="co">#&gt;             Ratio: 0.90</span>
<span class="fu"><a href="https://easystats.github.io/performance/reference/check_zeroinflation.html">check_zeroinflation</a></span><span class="op">(</span><span class="va">ziNB_mod2</span><span class="op">)</span>
<span class="co">#&gt; # Check for zero-inflation</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Observed zeros: 156</span>
<span class="co">#&gt;   Predicted zeros: 142</span>
<span class="co">#&gt;             Ratio: 0.91</span></code></pre></div>
<p>Aqui vemos que o modelo zero-altered (Hurdle Model) conseguiu predizer exatamente a quantidade de zeros observada, fazendo com que o modelo seja suficiente para usarmos com esses dados.</p>
<div class="sourceCode" id="cb329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Seleção de modelos</span>
<span class="fu"><a href="https://rdrr.io/pkg/bbmle/man/ICtab.html">ICtab</a></span><span class="op">(</span><span class="va">pois_plain</span>, <span class="va">hur_NB</span>, <span class="va">ziP_mod2</span>, <span class="va">ziNB_mod2</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AICc"</span><span class="op">)</span>, weights <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt;            dAICc df weight</span>
<span class="co">#&gt; ziP_mod2    0.0  10 0.62  </span>
<span class="co">#&gt; ziNB_mod2   1.6  11 0.28  </span>
<span class="co">#&gt; hur_NB      3.6  11 0.10  </span>
<span class="co">#&gt; pois_plain 44.6  5  &lt;0.001</span></code></pre></div>
<p>Mas quando comparamos o AICc entre modelos, os modelos zero-inflated (tanto Poisson, quanto binomial negativa) que tem menos parâmetros, são ranqueados ligeiramente melhor do que o modelo binomial negativa zero-altered (ou hurdle). Não podemos distinguir entre os dois modelos com zero-inflated porque o dAICc &lt; 2, ou seja, o ajuste deles aos dados são praticamente iguais. Vejam que a diferença de Akaike Weights entre os dois primeiros modelos e o hurdle é bastante substancial (0.34 e 0.52). Além disso, vemos que os modelos que levam em conta o excesso de zeros se ajustam bem melhor aos dados do que o modelo simples com distribuição Poisson.
Vamos ver como os modelos se saem em relação aos outros pressupostos.</p>
<p>Modelo <em>Hurdle</em> (Figura <a href="cap8.html#fig:fig-mod-zero-diag">8.20</a>).</p>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnoses</span>
<span class="va">simulationOutput</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/simulateResiduals.html">simulateResiduals</a></span><span class="op">(</span>fittedModel <span class="op">=</span> <span class="va">hur_NB</span>, plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-zero-diag"></span>
<img src="livro_files/figure-html/fig-mod-zero-diag-1.png" alt="Diagnose avançada dos resíduos do modelo GLM Hurdle." width="100%" height="100%"><p class="caption">
Figura 8.20: Diagnose avançada dos resíduos do modelo GLM Hurdle.
</p>
</div>
<p>Modelo <em>zero-inflated</em> Poisson (Figura <a href="cap8.html#fig:fig-mod-zero-diag1">8.21</a>).</p>
<div class="sourceCode" id="cb331"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnoses</span>
<span class="va">simulationOutput</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/simulateResiduals.html">simulateResiduals</a></span><span class="op">(</span>fittedModel <span class="op">=</span> <span class="va">ziP_mod2</span>, plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-zero-diag1"></span>
<img src="livro_files/figure-html/fig-mod-zero-diag1-1.png" alt="Diagnose avançada dos resíduos do modelo GLM zero-inflated Poisson." width="100%" height="100%"><p class="caption">
Figura 8.21: Diagnose avançada dos resíduos do modelo GLM zero-inflated Poisson.
</p>
</div>
<p>Modelo <em>zero-inflated negative binomial</em> (Figura <a href="cap8.html#fig:fig-mod-zero-diag2">8.22</a>).</p>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnoses</span>
<span class="va">simulationOutput</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/simulateResiduals.html">simulateResiduals</a></span><span class="op">(</span>fittedModel <span class="op">=</span> <span class="va">ziNB_mod2</span>, plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> </code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-zero-diag2"></span>
<img src="livro_files/figure-html/fig-mod-zero-diag2-1.png" alt="Diagnose avançada dos resíduos do modelo GLM zero-inflated negative binomial." width="100%" height="100%"><p class="caption">
Figura 8.22: Diagnose avançada dos resíduos do modelo GLM zero-inflated negative binomial.
</p>
</div>
<p>Os gráficos de diagnose do <code>DHARMa</code> são outra evidência de que tanto o modelo hurdle quanto o zero-inflated Poisson são adequados para os dados, em termos de homogeneidade de variância, <em>outliers</em> e <em>overdispersion</em>.</p>
<p><strong>Interpretação dos resultados</strong></p>
<p>Apesar de não ter um ajuste tão bom aos dados, o modelo hurdle prediz melhor a quantidade de zeros. Portanto, vamos interpretar os coeficientes apenas deste modelo.</p>
<div class="sourceCode" id="cb333"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Coeficientes estimados pelo modelo</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">hur_NB</span><span class="op">)</span>
<span class="co">#&gt;  Family: truncated_nbinom2  ( log )</span>
<span class="co">#&gt; Formula:          Raillietiella_mottae ~ CRC + Sexo * Especie</span>
<span class="co">#&gt; Zero inflation:                        ~.</span>
<span class="co">#&gt; Data: parasitas</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span>
<span class="co">#&gt;    277.8    313.8   -127.9    255.8      184 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Dispersion parameter for truncated_nbinom2 family (): 4.64 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Conditional model:</span>
<span class="co">#&gt;                                     Estimate Std. Error z value Pr(&gt;|z|)  </span>
<span class="co">#&gt; (Intercept)                          3.03428    2.36511   1.283   0.1995  </span>
<span class="co">#&gt; CRC                                 -0.05041    0.04861  -1.037   0.2997  </span>
<span class="co">#&gt; SexoM                               -1.49505    0.71440  -2.093   0.0364 *</span>
<span class="co">#&gt; EspeciePhyllopezus_pollicaris        0.68945    1.09380   0.630   0.5285  </span>
<span class="co">#&gt; SexoM:EspeciePhyllopezus_pollicaris  1.75281    0.94217   1.860   0.0628 .</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Zero-inflation model:</span>
<span class="co">#&gt;                                     Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)                           7.6283     1.8529   4.117 3.84e-05 ***</span>
<span class="co">#&gt; CRC                                  -0.1291     0.0369  -3.499 0.000468 ***</span>
<span class="co">#&gt; SexoM                                -1.0893     0.5867  -1.856 0.063386 .  </span>
<span class="co">#&gt; EspeciePhyllopezus_pollicaris         2.2701     0.9140   2.484 0.013003 *  </span>
<span class="co">#&gt; SexoM:EspeciePhyllopezus_pollicaris   2.2002     0.8192   2.686 0.007239 ** </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>Para maiores detalhes na interpretação deste tipo de modelo, sugerimos fortemente consultar p. 382-3 de Brooks et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-brooks2017a" role="doc-biblioref">2017</a>)</span>. Para fatores com mais de um nível, o <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> mostra os resultados usando contraste, para isto toma como referência um dos níveis do fator (o primeiro em ordem alfabética) e o compara com os outros. Note que na parte com excesso de zeros, o contraste é positivo para Espécie. Ou seja, o <em>P. pollicaris</em> tem maior chance de ter ausência de parasitas que <em>H. agrius</em>. O contraste para espécie continua sendo positivo na parte condicional do modelo, mas o valor do parâmetro não é tão alto. Isso quer dizer que <em>P. pollicaris</em> tem abundância de parasitas em média ligeiramente maior que <em>H. agrius</em>. Vemos que a interação é significativa entre sexo e espécie na parte do modelo com excesso de zeros, mas apenas marginalmente significativa na parte condicional. Portanto, a influência do sexo na incidência, mas não na abundância do parasita depende conjuntamente da espécie. No entanto, o CRC só passa a ser significativo na parte de excesso de zeros, ou seja, quando modelamos apenas a incidência (presença-ausência) do parasita. Portanto, o <em>CRC determina se o lagarto vai ou não ser infectado, mas não <bold>o quanto</bold> vai receber de parasitas</em>. Já tanto o sexo quanto a espécie foram significativas em ambas as partes do modelo, ou seja, esses fatores não influenciam diferentemente a infecção e a quantidade de parasitas.
Agora vejamos como podemos plotar as predições deste modelo (Figura <a href="cap8.html#fig:fig-mod-zero-model">8.23</a>).</p>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Gráfico</span>
<span class="va">parasitas</span><span class="op">$</span><span class="va">phat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">hur_NB</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
<span class="va">parasitas</span> <span class="op">&lt;-</span> <span class="va">parasitas</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">parasitas</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">Sexo</span>, <span class="va">Especie</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">parasitas</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">CRC</span>, y <span class="op">=</span> <span class="va">phat</span>, colour <span class="op">=</span> <span class="va">Especie</span>,
                      shape <span class="op">=</span> <span class="va">Sexo</span>, linetype <span class="op">=</span> <span class="va">Sexo</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Raillietiella_mottae</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span>, 
               alpha <span class="op">=</span> <span class="fl">.7</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html">position_jitter</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkorange"</span>, <span class="st">"cyan4"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkorange"</span>, <span class="st">"cyan4"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Comprimento Rostro-Cloacal"</span>, 
         y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Abundância de "</span>, <span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="st">"Raillietiella mottae"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">tema_livro</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-zero-model"></span>
<img src="livro_files/figure-html/fig-mod-zero-model-1.png" alt="Gráfico do GLM Hurdle." width="100%" height="100%"><p class="caption">
Figura 8.23: Gráfico do GLM Hurdle.
</p>
</div>
</div>
<div id="dados-ordinais-os-modelos-cumulative-link" class="section level2" number="8.9">
<h2>
<span class="header-section-number">8.9</span> Dados ordinais: os modelos cumulative link<a class="anchor" aria-label="anchor" href="#dados-ordinais-os-modelos-cumulative-link"><i class="fas fa-link"></i></a>
</h2>
<p>Uma outra maneira de codificarmos os dados é utilizando categorias ordenadas, tais como ranques. Exemplos incluem a escala de Likert, scores e intervalos (e.g., de idade).</p>
<p>Para este exemplo, iremos utilizar um outro conjunto de dados do artigo de <span class="citation">(<a href="refer%C3%AAncias.html#ref-Franco-Belussi2018a" role="doc-biblioref">Franco-Belussi, De Oliveira, and Sköld 2018</a>)</span> que manipulou <em>in vitro</em> a concentração do hormônio noradrenalina nos olhos de peixes esgana-gato (<em>Gasterosteus aculeatus</em>) e avaliaram a expressão de várias cores conferidas por tipos de células (cromatóforos). Aqui vamos usar os dados do efeito da noradrenalina na cor vermelha em machos.
Neste experimento, os autores realizaram medidas repetidas no mesmo animal ao longo do tempo (que é um dos fatores deste experimento). Portanto, para não incorrer no risco de pseudoréplicas deveríamos incluir esta informação no modelo. A maneira mais simples de fazê-lo é criar um modelo de efeito misto em que teríamos uma parte fixa (o que de fato estamos interessados em testar) e outra aleatória (variáveis que precisamos controlar). Portanto, <code>Animal</code> será incluído como um fator aleatório, tendo um intercepto estimado separadamente para cada animal no modelo. Não iremos entrar em detalhes sobre modelos de efeito misto porque necessitaríamos de um outro capítulo para isso, dada a complexidade do assunto. No entanto, recomendamos aos leitores dois artigos introdutórios muito bons - Harisson <span class="citation">(<a href="refer%C3%AAncias.html#ref-Harrison" role="doc-biblioref">2018</a>)</span> e Bolker et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-BOLKER2009127" role="doc-biblioref">2009</a>)</span>.</p>
<p><strong>Pergunta</strong></p>
<p>A noradrenalina causa uma diminuição da coloração vermelha, via agregação dos pigmentos?</p>
<p><strong>Predições</strong></p>
<p>A presença de noradrenalina causa a agregação dos pigmentos, permitindo que os hormônios reprodutivos atuem.</p>
<p><strong>Variáveis</strong></p>
<ul>
<li>Variável resposta: escala de intensidade de cor. Para mais detalhes veja o artigo original <span class="citation">(<a href="refer%C3%AAncias.html#ref-Franco-Belussi2018a" role="doc-biblioref">Franco-Belussi, De Oliveira, and Sköld 2018</a>)</span>.</li>
</ul>
<div class="sourceCode" id="cb335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar os dados</span>
<span class="va">cores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv2</a></span><span class="op">(</span><span class="st">"https://ndownloader.figshare.com/files/10250700"</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cores</span><span class="op">)</span>
<span class="co">#&gt;   Animal Treatment Time Sex Black Red</span>
<span class="co">#&gt; 1      1        CT   0h   M     5   5</span>
<span class="co">#&gt; 2      1        CT   1h   M     5   5</span>
<span class="co">#&gt; 3      1        CT   2h   M     5   5</span>
<span class="co">#&gt; 4      1        CT   3h   M     5   5</span>
<span class="co">#&gt; 5      2        CT   0h   M     5   4</span>
<span class="co">#&gt; 6      2        CT   1h   M     5   4</span>

<span class="co">## Tradução dos nomes das colunas</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">cores</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"animal"</span>, <span class="st">"tratamento"</span>, <span class="st">"tempo"</span>, <span class="st">"sexo"</span>, <span class="st">"preto"</span>, <span class="st">"vermelho"</span><span class="op">)</span>

<span class="co">## Filtrando dados - macho vermelho</span>
<span class="va">macho_verm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cores</span>, <span class="va">sexo</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">macho_verm</span><span class="op">)</span>
<span class="co">#&gt;   animal tratamento tempo sexo preto vermelho</span>
<span class="co">#&gt; 1      1         CT    0h    M     5        5</span>
<span class="co">#&gt; 2      1         CT    1h    M     5        5</span>
<span class="co">#&gt; 3      1         CT    2h    M     5        5</span>
<span class="co">#&gt; 4      1         CT    3h    M     5        5</span>
<span class="co">#&gt; 5      2         CT    0h    M     5        4</span>
<span class="co">#&gt; 6      2         CT    1h    M     5        4</span></code></pre></div>
<p>Esses dados, no entanto, têm de ser codificados como um fator ordenado antes de entrarmos com eles no modelo.</p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Fator</span>
<span class="va">macho_verm</span><span class="op">$</span><span class="va">animal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">macho_verm</span><span class="op">$</span><span class="va">animal</span><span class="op">)</span>
<span class="va">macho_verm</span><span class="op">$</span><span class="va">vermelho_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">macho_verm</span><span class="op">$</span><span class="va">vermelho</span>, 
                      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span><span class="op">)</span>, 
                      ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">macho_verm</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    40 obs. of  7 variables:</span>
<span class="co">#&gt;  $ animal      : Factor w/ 5 levels "1","2","3","4",..: 1 1 1 1 2 2 2 2 3 3 ...</span>
<span class="co">#&gt;  $ tratamento  : chr  "CT" "CT" "CT" "CT" ...</span>
<span class="co">#&gt;  $ tempo       : chr  "0h" "1h" "2h" "3h" ...</span>
<span class="co">#&gt;  $ sexo        : chr  "M" "M" "M" "M" ...</span>
<span class="co">#&gt;  $ preto       : int  5 5 5 5 5 5 5 5 4 4 ...</span>
<span class="co">#&gt;  $ vermelho    : int  5 5 5 5 4 4 4 4 4 4 ...</span>
<span class="co">#&gt;  $ vermelho_ord: Ord.factor w/ 5 levels "1"&lt;"2"&lt;"3"&lt;"4"&lt;..: 5 5 5 5 4 4 4 4 4 4 ...</span></code></pre></div>
<p>Repare que a classe do objeto muda e temos agora que Red é um <code>Ordered factor</code>.</p>
<p><strong>Modelagem</strong></p>
<p>Vamos ajustar um modelo cumulative link, utilizando a função <code><a href="https://rdrr.io/pkg/ordinal/man/clmm.html">clmm()</a></code> do pacote <code>ordinal</code>.</p>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Modelo</span>
<span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ordinal/man/clmm.html">clmm</a></span><span class="op">(</span><span class="va">vermelho_ord</span> <span class="op">~</span> <span class="va">tratamento</span> <span class="op">+</span> <span class="va">tempo</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">animal</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">macho_verm</span>, threshold <span class="op">=</span> <span class="st">"equidistant"</span><span class="op">)</span></code></pre></div>
<p><strong>Diagnose</strong></p>
<p>Infelizmente, o pacote <code>ordinal</code> não fornece métodos para lidar com modelos mistos, como o nosso. Então, montamos um modelo fixo apenas para entrar nas duas funções de diagnose. Essas duas funções <code><a href="https://rdrr.io/pkg/ordinal/man/nominal.test.html">scale_test()</a></code> e <code><a href="https://rdrr.io/pkg/ordinal/man/nominal.test.html">nominal_test()</a></code> testam a qualidade do ajuste (<em>goodness-of-fit</em>) do modelo, similar aos <em>likelihood-ratio test</em>, só que para dados ordinais.</p>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnose</span>
<span class="va">assumption3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ordinal/man/clm.html">clm</a></span><span class="op">(</span><span class="va">vermelho_ord</span> <span class="op">~</span> <span class="va">tratamento</span> <span class="op">+</span> <span class="va">tempo</span>, data <span class="op">=</span> <span class="va">macho_verm</span>, threshold <span class="op">=</span> <span class="st">"equidistant"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ordinal/man/nominal.test.html">scale_test</a></span><span class="op">(</span><span class="va">assumption3</span><span class="op">)</span>
<span class="co">#&gt; Tests of scale effects</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; formula: vermelho_ord ~ tratamento + tempo</span>
<span class="co">#&gt;            Df  logLik    AIC      LRT Pr(&gt;Chi)</span>
<span class="co">#&gt; &lt;none&gt;        -24.301 60.602                  </span>
<span class="co">#&gt; tratamento  1 -24.293 62.586 0.015248   0.9017</span>
<span class="co">#&gt; tempo</span>
<span class="fu"><a href="https://rdrr.io/pkg/ordinal/man/nominal.test.html">nominal_test</a></span><span class="op">(</span><span class="va">assumption3</span><span class="op">)</span>
<span class="co">#&gt; Tests of nominal effects</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; formula: vermelho_ord ~ tratamento + tempo</span>
<span class="co">#&gt;            Df  logLik    AIC    LRT Pr(&gt;Chi)   </span>
<span class="co">#&gt; &lt;none&gt;        -24.301 60.602                   </span>
<span class="co">#&gt; tratamento  1 -19.749 53.499 9.1031 0.002552 **</span>
<span class="co">#&gt; tempo       3 -22.803 63.606 2.9953 0.392356   </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>Parece que não há problemas com o efeito de escala do dado ordinal, mas a diagnose sugere que possa haver evidência de rompimento do pressuposto de probabilidades proporcionais em relação ao tratamento. Esse é um pressuposto importante de modelos ordinais, os quais assumem que os efeitos de qualquer uma das variáveis explicativas são consistentes (proporcionais) ao longo de diferentes <em>thresholds</em> (que são as quebras entre cada par de categorias da variável resposta ordinal).</p>
<p>Isto provavelmente se deve ao baixo tamanho amostral. Por questão de brevidade vamos apenas ignorar este aspecto e interpretar o resultado do modelo mesmo assim. Mas se o seu modelo apresentar este problema, a solução deve ser realizar regressões logísticas separadamente.</p>
<p><strong>Inferência</strong></p>
<p>Vamos analisar os parâmetros do modelo.</p>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Coeficientes estimados pelo modelo</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span>
<span class="co">#&gt; Cumulative Link Mixed Model fitted with the Laplace approximation</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; formula: vermelho_ord ~ tratamento + tempo + (1 | animal)</span>
<span class="co">#&gt; data:    macho_verm</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  link  threshold   nobs logLik AIC   niter    max.grad cond.H </span>
<span class="co">#&gt;  logit equidistant 40   -22.89 59.77 226(681) 1.04e-05 4.1e+01</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random effects:</span>
<span class="co">#&gt;  Groups Name        Variance Std.Dev.</span>
<span class="co">#&gt;  animal (Intercept) 1.438    1.199   </span>
<span class="co">#&gt; Number of groups:  animal 5 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                  Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; tratamentoNA10uM   -4.602      1.228  -3.748 0.000178 ***</span>
<span class="co">#&gt; tempo1h            -3.602      1.377  -2.616 0.008894 ** </span>
<span class="co">#&gt; tempo2h            -3.602      1.377  -2.616 0.008894 ** </span>
<span class="co">#&gt; tempo3h            -3.602      1.377  -2.616 0.008894 ** </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Threshold coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value</span>
<span class="co">#&gt; threshold.1   -6.198      1.722   -3.60</span>
<span class="co">#&gt; spacing        4.978      1.254    3.97</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">assumption3</span><span class="op">)</span>
<span class="co">#&gt; Type I Analysis of Deviance Table with Wald chi-square tests</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;            Df   Chisq Pr(&gt;Chisq)    </span>
<span class="co">#&gt; tratamento  1 15.3616  8.877e-05 ***</span>
<span class="co">#&gt; tempo       3  9.1992    0.02676 *  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html">pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/emmeans/man/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mod3</span>, <span class="op">~</span> <span class="va">tratamento</span><span class="op">|</span><span class="va">tempo</span>, adjust <span class="op">=</span> <span class="st">"tukey"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; tempo = 0h:</span>
<span class="co">#&gt;  contrast    estimate   SE  df z.ratio p.value</span>
<span class="co">#&gt;  CT - NA10uM      4.6 1.23 Inf   3.748  0.0002</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; tempo = 1h:</span>
<span class="co">#&gt;  contrast    estimate   SE  df z.ratio p.value</span>
<span class="co">#&gt;  CT - NA10uM      4.6 1.23 Inf   3.748  0.0002</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; tempo = 2h:</span>
<span class="co">#&gt;  contrast    estimate   SE  df z.ratio p.value</span>
<span class="co">#&gt;  CT - NA10uM      4.6 1.23 Inf   3.748  0.0002</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; tempo = 3h:</span>
<span class="co">#&gt;  contrast    estimate   SE  df z.ratio p.value</span>
<span class="co">#&gt;  CT - NA10uM      4.6 1.23 Inf   3.748  0.0002</span></code></pre></div>
<p>Aqui vemos que tanto o tratamento, quanto o tempo de exposição foram significativos.</p>
<p><strong>Interpretação dos resultados</strong></p>
<p>Vamos analisar a predição do modelo (Figura <a href="cap8.html#fig:fig-mod-ord-model">8.24</a>).</p>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Gráfico</span>

<span class="co"># Calcular média e erro padrão</span>
<span class="va">macho_verm_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rmisc/man/summarySE.html">summarySE</a></span><span class="op">(</span><span class="va">macho_verm</span>, 
                        measurevar <span class="op">=</span> <span class="st">"vermelho"</span>,
                        groupvars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tempo"</span>, <span class="st">"tratamento"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Definir posição de linhas e pontos no gráfico</span>
<span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>

<span class="va">macho_verm_res</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tempo</span>, y <span class="op">=</span> <span class="va">vermelho</span>, colour <span class="op">=</span> <span class="va">tratamento</span>,
             group <span class="op">=</span> <span class="va">tratamento</span>, fill <span class="op">=</span> <span class="va">tratamento</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">vermelho</span><span class="op">-</span><span class="va">se</span>, ymax<span class="op">=</span><span class="va">vermelho</span> <span class="op">+</span><span class="va">se</span><span class="op">)</span>, 
                width<span class="op">=</span><span class="fl">.1</span>, size <span class="op">=</span> <span class="fl">1.1</span>, position<span class="op">=</span><span class="va">pd</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>position<span class="op">=</span><span class="va">pd</span>, size <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">21</span>, colour <span class="op">=</span> <span class="st">"black"</span>, position<span class="op">=</span><span class="va">pd</span>, size<span class="op">=</span><span class="fl">3.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkorange"</span>, <span class="st">"cyan4"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkorange"</span>, <span class="st">"cyan4"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Tempo de exposição (horas)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Índice de eritróforos"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">tema_livro</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-ord-model"></span>
<img src="livro_files/figure-html/fig-mod-ord-model-1.png" alt="Gráfico do modelo cumulative link." width="100%" height="100%"><p class="caption">
Figura 8.24: Gráfico do modelo cumulative link.
</p>
</div>
<p>Neste gráfico vemos que o grupo tratado com o hormônio começa com um índice de eritróforo ligeiramente maior do que o controle, mas logo tem uma brusca redução com uma hora de exposição, passando a ter índice 2, demonstrando que houve uma mudança de cor induzida pela dispersão dos cromatóforos. Já no controle, o índice não muda em relação ao tempo de exposição. Logo, podemos ver que há uma interação entre os fatores devido a esta queda do índice no grupo tratado e a ausência de efeito no controle.</p>
</div>
<div id="dados-contínuos-distribuição-beta" class="section level2" number="8.10">
<h2>
<span class="header-section-number">8.10</span> Dados contínuos: distribuição beta<a class="anchor" aria-label="anchor" href="#dados-cont%C3%ADnuos-distribui%C3%A7%C3%A3o-beta"><i class="fas fa-link"></i></a>
</h2>
<p>Aqui vamos utilizar como exemplo os dados do artigo de Franco-Belussi et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-Franco-Belussi2018a" role="doc-biblioref">2018</a>)</span>. Os pesquisadores fizeram um experimento <em>in vivo</em> com peixes esgana-gato (<em>Gasterosteus aculeatus</em>) para testar como a coloração dos animais respondem ao fármaco ioimbina (YOH), que bloqueia a coloração típica que os machos exibem na época de acasalamento, e o tempo de exposição ao mesmo (além de um controle), num desenho de ANOVA fatorial. Como as medidas foram feitas repetidamente no mesmo animal, iremos incluir o <code>Animal</code> como um fator aleatório no modelo.</p>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">fish</span><span class="op">)</span>
<span class="co">#&gt;   Animal Treatment Time Sex Darkness Redness</span>
<span class="co">#&gt; 1      1        CT   0h   M    56.42  131.17</span>
<span class="co">#&gt; 2      1        CT   1h   M    49.53  133.30</span>
<span class="co">#&gt; 3      1        CT   2h   M    54.94  132.69</span>
<span class="co">#&gt; 4      1        CT   3h   M    42.19  135.37</span>
<span class="co">#&gt; 5      2        CT   0h   M    58.93  133.35</span>
<span class="co">#&gt; 6      2        CT   1h   M    52.45  133.65</span>

<span class="co">## Tradução dos nomes das colunas</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fish</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"animal"</span>, <span class="st">"tratamento"</span>, <span class="st">"tempo"</span>, <span class="st">"sexo"</span>, <span class="st">"preto"</span>, <span class="st">"vermelho"</span><span class="op">)</span></code></pre></div>
<p>Esses dados contêm as variáveis resposta medidas no experimento: a quantidade de vermelho e preto. Além dos fatores manipulados: Tratamento (controle e presença de YOH) e tempo de exposição.</p>
<p><strong>Pergunta</strong></p>
<p>A YOH aumenta a coloração escura no olho e mandíbula dos peixes via dispersão dos pigmentos?</p>
<p><strong>Predições</strong></p>
<p>A YOH promoverá um escurecimento do corpo do animal, já que ela inibe a ação NorAdrenalia (NA).</p>
<p><strong>Variáveis</strong></p>
<ul>
<li>Variável resposta: a intensidade de coloração escura em peixes machos. Esses dados são expressos em termos de porcentagem e variam continuamente de 0 a 100%. Para facilitar a modelagem e nos adequarmos à maneira com que a função requer os dados, vamos simplesmente dividir por 100 para que os dados variem entre 0 e 1</li>
</ul>
<p>Para modelar os dados vamos utilizar a função <code>glmmTMB</code>. Antes disso, vamos analisar graficamente os dados (Figura <a href="cap8.html#fig:fig-mod-beta-pre">8.25</a>). Vamos usar apenas os dados dos machos para este exemplo.</p>
<div class="sourceCode" id="cb342"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Filtrando os dados</span>
<span class="va">fish</span><span class="op">$</span><span class="va">animal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">fish</span><span class="op">$</span><span class="va">animal</span><span class="op">)</span>
<span class="va">fish</span><span class="op">$</span><span class="va">sexo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">fish</span><span class="op">$</span><span class="va">sexo</span><span class="op">)</span>
<span class="va">macho_preto</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">fish</span>, <span class="va">sexo</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span>

<span class="co">## Gráfico</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">macho_preto</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">preto</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"cyan4"</span>, fill <span class="op">=</span> <span class="st">"cyan4"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Índice de escuridão do corpo"</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">tema_livro</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-beta-pre"></span>
<img src="livro_files/figure-html/fig-mod-beta-pre-1.png" alt="Gráfico para explorar a distribuição da variável resposta." width="100%" height="100%"><p class="caption">
Figura 8.25: Gráfico para explorar a distribuição da variável resposta.
</p>
</div>
<p>No histograma podemos ver que os dados de fato variam continuamente no intervalo entre 0 e 1, tendo uma distribuição notadamente bimodal.</p>
<p><strong>Modelagem</strong></p>
<p>Vamos ajustar um GLM Beta.</p>
<div class="sourceCode" id="cb343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Modelo</span>
<span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html">glmmTMB</a></span><span class="op">(</span><span class="va">preto</span><span class="op">/</span><span class="fl">100</span> <span class="op">~</span> <span class="va">tratamento</span> <span class="op">*</span> <span class="va">tempo</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">animal</span><span class="op">)</span>, family <span class="op">=</span> <span class="va">beta_family</span>, data <span class="op">=</span> <span class="va">macho_preto</span><span class="op">)</span></code></pre></div>
<p><strong>Diagnose</strong></p>
<p>Aqui utilizaremos o mesmo pacote <code>DHARMa</code> para realizar a diagnose do modelo
(Figura <a href="cap8.html#fig:fig-mod-beta-diag">8.26</a>).</p>
<div class="sourceCode" id="cb344"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Diagnóse</span>
<span class="va">simulationOutput</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/simulateResiduals.html">simulateResiduals</a></span><span class="op">(</span>fittedModel <span class="op">=</span> <span class="va">mod2</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-beta-diag"></span>
<img src="livro_files/figure-html/fig-mod-beta-diag-1.png" alt="Diagnose avançada dos resíduos do modelo GLM Beta." width="100%" height="100%"><p class="caption">
Figura 8.26: Diagnose avançada dos resíduos do modelo GLM Beta.
</p>
</div>
<p>Podemos ver que o modelo não sofre de heterogeneidade de dispersão, overdispersion, nem problemas com <em>outlier</em>.</p>
<p><strong>Interpretação dos resultados</strong></p>
<p>Agora que podemos interpretar a saída do modelo ajustado com confiança, vamos obter a tabela de anova em que teremos os testes de cada fator do modelo.</p>
<div class="sourceCode" id="cb345"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Coeficientes estimados pelo modelo</span>
<span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span>
<span class="co">#&gt; Analysis of Deviance Table (Type II Wald chisquare tests)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Response: preto/100</span>
<span class="co">#&gt;                    Chisq Df Pr(&gt;Chisq)    </span>
<span class="co">#&gt; tratamento       105.546  1  &lt; 2.2e-16 ***</span>
<span class="co">#&gt; tempo             40.719  3  7.499e-09 ***</span>
<span class="co">#&gt; tratamento:tempo  49.262  3  1.147e-10 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>Aqui vemos que a interação é significativa. Portanto, temos de interpretar os níveis do fator da combinação, fazemos isso no pacote <code>emmeans</code> colocando a barra |.</p>
<div class="sourceCode" id="cb346"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## níveis do fator da combinação</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html">pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/emmeans/man/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">mod2</span>, <span class="op">~</span> <span class="va">tratamento</span><span class="op">|</span><span class="va">tempo</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; tempo = 0h:</span>
<span class="co">#&gt;  contrast estimate    SE df t.ratio p.value</span>
<span class="co">#&gt;  CT - YOH   0.0283 0.160 30   0.177  0.8609</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; tempo = 1h:</span>
<span class="co">#&gt;  contrast estimate    SE df t.ratio p.value</span>
<span class="co">#&gt;  CT - YOH  -1.3068 0.181 30  -7.210  &lt;.0001</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; tempo = 2h:</span>
<span class="co">#&gt;  contrast estimate    SE df t.ratio p.value</span>
<span class="co">#&gt;  CT - YOH  -1.2286 0.182 30  -6.763  &lt;.0001</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; tempo = 3h:</span>
<span class="co">#&gt;  contrast estimate    SE df t.ratio p.value</span>
<span class="co">#&gt;  CT - YOH  -1.4025 0.185 30  -7.582  &lt;.0001</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results are given on the log odds ratio (not the response) scale.</span></code></pre></div>
<p>Agora podemos perceber que a diferença entre o controle e o tratado só passa a ser significativa depois de 1 h de exposição.</p>
<p>Isso fica mais evidente quando plotamos os dados (Figura <a href="cap8.html#fig:fig-mod-beta-model">8.27</a>).</p>
<div class="sourceCode" id="cb347"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Gráfico</span>
<span class="va">escuridao</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rmisc/man/summarySE.html">summarySE</a></span><span class="op">(</span><span class="va">macho_preto</span>, 
                        measurevar <span class="op">=</span> <span class="st">"preto"</span>,
                        groupvars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tempo"</span>, <span class="st">"tratamento"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Definir posição de linhas e pontos no gráfico</span>
<span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>

<span class="va">escuridao</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tempo</span>, y <span class="op">=</span> <span class="va">preto</span>, colour <span class="op">=</span> <span class="va">tratamento</span>,
             group <span class="op">=</span> <span class="va">tratamento</span>, fill <span class="op">=</span> <span class="va">tratamento</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">preto</span><span class="op">-</span><span class="va">se</span>, ymax<span class="op">=</span><span class="va">preto</span> <span class="op">+</span><span class="va">se</span><span class="op">)</span>, 
                width<span class="op">=</span><span class="fl">.1</span>, size <span class="op">=</span> <span class="fl">1.1</span>, position<span class="op">=</span><span class="va">pd</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>position<span class="op">=</span><span class="va">pd</span>, size <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">21</span>, colour <span class="op">=</span> <span class="st">"black"</span>, position<span class="op">=</span><span class="va">pd</span>, size<span class="op">=</span><span class="fl">3.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkorange"</span>, <span class="st">"cyan4"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkorange"</span>, <span class="st">"cyan4"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Tempo de experimento (horas)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Índice de escuridão do corpo"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">tema_livro</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mod-beta-model"></span>
<img src="livro_files/figure-html/fig-mod-beta-model-1.png" alt="Gráfico do modelo GLM beta." width="100%" height="100%"><p class="caption">
Figura 8.27: Gráfico do modelo GLM beta.
</p>
</div>
</div>
<div id="para-se-aprofundar-4" class="section level2" number="8.11">
<h2>
<span class="header-section-number">8.11</span> Para se aprofundar<a class="anchor" aria-label="anchor" href="#para-se-aprofundar-4"><i class="fas fa-link"></i></a>
</h2>
<p>Neste capítulo apenas fizemos uma breve introdução aos modelos lineares generalizados. Para conhecer um pouco mais a fundo todos os detalhes, recomendamos a consulta dos livros - Zurr et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-zuur_mixed_2009" role="doc-biblioref">2009</a>)</span> <em>Mixed effects models and extensions in ecology with R</em> e Pinheiro &amp; Bates <span class="citation">(<a href="refer%C3%AAncias.html#ref-pinheiro_mixed-effects_2000" role="doc-biblioref">Pinheiro and Bates 2000</a>)</span> <em>Mixed-Effects Models in S and S-PLUS</em> - que são as referências clássicas sobre GLM com aplicações em Ecologia. Para dados ordinais, sugerimos os livros - Agresti <span class="citation">(<a href="refer%C3%AAncias.html#ref-agresti2010" role="doc-biblioref">2010</a>)</span> <em>Analysis of ordinal categorical data</em> e Agresti <span class="citation">(<a href="refer%C3%AAncias.html#ref-agresti_categorical_2012" role="doc-biblioref">2012</a>)</span> <em>Categorical Data Analysis</em>.</p>
</div>
<div id="exercícios-4" class="section level2" number="8.12">
<h2>
<span class="header-section-number">8.12</span> Exercícios<a class="anchor" aria-label="anchor" href="#exerc%C3%ADcios-4"><i class="fas fa-link"></i></a>
</h2>
<p><strong>8.1</strong>
Baixe <a href="https://www.stat.berkeley.edu/~statlabs/labs.html#video">estes dados</a> que foram coletados numa pesquisa de opinião sobre uso de vídeo games por 91 estudantes de graduação no outono de 1994. Utilizando estes dados, construa um modelo para: 1) Predizer a frequência com que uma pessoa joga vídeo game em função da idade; 2) Predizer a nota do estudante em função do tempo que jogou na semana antes da entrevista. Dica: esses são dados ordinais!</p>
<p><strong>8.2</strong>
Uma pesquisadora interessada em entender o efeito de diferentes usos de solo sobre a abundância de morcegos em paisagens agroecológicas desenvolveu uma simulação para gerar dados parecidos com o que irá coletar em breve no campo. Ela utilizou uma abordagem que simula a abundância de uma espécie sob deriva ecológica segundo a Teoria Neutra da Biodiversidade. A simulação gerou os seguintes dados:</p>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span>
<span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">5000</span> <span class="co"># número de indivíduos na comunidade local</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="fl">50</span> <span class="co">#número fundamental da biodiversidade</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">0.05</span> <span class="co">#taxa de dispersão</span>
<span class="va">comm1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ecolottery/man/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, <span class="va">theta</span><span class="op">)</span> <span class="co">#simulação</span>
<span class="va">abund1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ecolottery/man/abund.html">abund</a></span><span class="op">(</span><span class="va">comm1a</span><span class="op">)</span> <span class="co">#extração de dados de abundância local</span></code></pre></div>
<p>Além disso, a pesquisadora também simulou dados que representam a porcentagem do solo destinado à agricultura:</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">porc_solo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">abund1a</span><span class="op">$</span><span class="va">com</span><span class="op">$</span><span class="va">ab</span><span class="op">)</span>, <span class="fl">10</span>, <span class="fl">90</span><span class="op">)</span> <span class="co">#simulação uso do solo para agricultura</span>

<span class="va">dados_finais</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>abund<span class="op">=</span><span class="va">abund1a</span><span class="op">$</span><span class="va">com</span><span class="op">$</span><span class="va">ab</span>, solo<span class="op">=</span><span class="va">porc_solo</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dados_finais</span><span class="op">)</span>
<span class="co">#&gt;   abund       solo</span>
<span class="co">#&gt; 1   161 0.11063484</span>
<span class="co">#&gt; 2    93 0.11498853</span>
<span class="co">#&gt; 3   185 0.05718937</span>
<span class="co">#&gt; 4    86 0.06134667</span>
<span class="co">#&gt; 5    35 0.18910965</span>
<span class="co">#&gt; 6    69 0.12660113</span></code></pre></div>
<p>Agora com esses dados ela pode ter uma idéia do que esperar quando for pra campo. Ajude a pesquisadora a construir um modelo linear generalizado que seja adequado para modelar a abundância desta espécie de morcego em função da porcentagem de agricultura. Lembre-se de que ela vai precisar diagnosticar o modelo antes de utilizá-lo para fazer uma inferência. Por fim, interprete os resultados e sugira uma possível interpretação para a pesquisadora.</p>
<p><a href="https://exercicios-livro-aer.netlify.app/cap.-8---modelos-lineares-generalizados.html">Soluções dos exercícios</a>.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="cap7.html"><span class="header-section-number">7</span> Modelos lineares</a></div>
<div class="next"><a href="cap9.html"><span class="header-section-number">9</span> Análises Multidimensionais</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="Nesta página"><h2><b>Nesta página</b></h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#cap8"><span class="header-section-number">8</span> Modelos Lineares Generalizados</a></li>
<li><a class="nav-link" href="#pr%C3%A9-requisitos-do-cap%C3%ADtulo-4">Pré-requisitos do capítulo</a></li>
<li><a class="nav-link" href="#introdu%C3%A7%C3%A3o-2"><span class="header-section-number">8.1</span> Introdução</a></li>
<li><a class="nav-link" href="#como-um-glm-funciona"><span class="header-section-number">8.2</span> Como um GLM funciona?</a></li>
<li>
<a class="nav-link" href="#como-escolher-a-distribui%C3%A7%C3%A3o-correta-para-seus-dados"><span class="header-section-number">8.3</span> Como escolher a distribuição correta para seus dados?</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#para-dados-cont%C3%ADnuos"><span class="header-section-number">8.3.1</span> Para dados contínuos</a></li>
<li><a class="nav-link" href="#para-dados-de-contagem"><span class="header-section-number">8.3.2</span> Para dados de contagem</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#dados-de-contagem-a-distribui%C3%A7%C3%A3o-de-poisson"><span class="header-section-number">8.4</span> Dados de contagem: a distribuição de Poisson</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#o-que-causa-a-overdispersion"><span class="header-section-number">8.4.1</span> O que causa a overdispersion?</a></li>
<li><a class="nav-link" href="#o-que-fazer-se-seu-modelo-tiver-overdispersion"><span class="header-section-number">8.4.2</span> O que fazer se seu modelo tiver overdispersion?</a></li>
</ul>
</li>
<li><a class="nav-link" href="#dados-de-contagem-modelos-quasi-likelihood"><span class="header-section-number">8.5</span> Dados de contagem: modelos quasi-likelihood</a></li>
<li>
<a class="nav-link" href="#dados-de-contagem-a-distribui%C3%A7%C3%A3o-binomial"><span class="header-section-number">8.6</span> Dados de contagem: a distribuição binomial</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#an%C3%A1lise-com-dados-de-propor%C3%A7%C3%A3o"><span class="header-section-number">8.6.1</span> Análise com dados de proporção</a></li></ul>
</li>
<li><a class="nav-link" href="#an%C3%A1lise-com-dados-de-incid%C3%AAncia"><span class="header-section-number">8.7</span> Análise com dados de incidência</a></li>
<li><a class="nav-link" href="#dados-de-contagem-com-excesso-de-zeros"><span class="header-section-number">8.8</span> Dados de contagem com excesso de zeros</a></li>
<li><a class="nav-link" href="#dados-ordinais-os-modelos-cumulative-link"><span class="header-section-number">8.9</span> Dados ordinais: os modelos cumulative link</a></li>
<li><a class="nav-link" href="#dados-cont%C3%ADnuos-distribui%C3%A7%C3%A3o-beta"><span class="header-section-number">8.10</span> Dados contínuos: distribuição beta</a></li>
<li><a class="nav-link" href="#para-se-aprofundar-4"><span class="header-section-number">8.11</span> Para se aprofundar</a></li>
<li><a class="nav-link" href="#exerc%C3%ADcios-4"><span class="header-section-number">8.12</span> Exercícios</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/paternogbc/livro_aer/blob/master/08_modelos_lineares_generalizados.Rmd">Ver fonte <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/paternogbc/livro_aer/edit/master/08_modelos_lineares_generalizados.Rmd">Editar esta página <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Análises Ecológicas no R</strong>" foi escrito por Fernando Rodrigues da Silva, Thiago Gonçalves-Souza, Gustavo Brant Paterno, <br> Diogo Borges Provete, Maurício Humberto Vancine. Última atualização 2022-06-08.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>Este livro foi compilado com o pacote R <a class="text-light" href="https://bookdown.org">bookdown</a>.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
